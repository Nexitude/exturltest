/// Copyright (c) FurryR 2023. This project is licensed under the MIT license.
/// Original repository: https://github.com/FurryR/lpp-scratch

"use strict";(()=>{var St=Object.defineProperty;var Lt=(o,s)=>{for(var n in s)St(o,n,{get:s[n],enumerable:!0})};var bt={en:{"lpp.name":"lpp","lpp.block.construct.Number":"Number","lpp.block.construct.String":"String","lpp.block.construct.Function":"function","lpp.block.operator.var":"var","lpp.block.operator.self":"self","lpp.block.statement.return":"return","lpp.block.statement.throw":"throw","lpp.block.statement.scope":"scope","lpp.block.statement.try.1":"try","lpp.block.statement.try.2":"catch","lpp.error.useAfterDispose.summary":"Cannot operate sprite on a disposed target.","lpp.error.useAfterDispose.detail":"This error happens when you call a function which belongs to a disposed target, whose sprite is operated on. Please review your code.","lpp.error.useOutsideFunction.summary":"Cannot use this block outside a function context.","lpp.error.useOutsideFunction.detail":"Block outside a function context is used. Please note that this block must be used in function contexts.","lpp.error.useOutsideContext.summary":"Cannot use this block outside a lpp context.","lpp.error.useOutsideContext.detail":'You used the block outside a lpp context. Please create a lpp context use "scope" block first.',"lpp.error.syntaxError.summary":"Syntax error.","lpp.error.syntaxError.detail":"You used the block incorrectly. Please note that lpp doesn't allow direct usages of Scratch literals (index access is a exception).","lpp.error.accessOfNull.summary":"Invalid access of null.","lpp.error.accessOfNull.detail":"Please validate the object before you use.","lpp.error.assignOfConstant.summary":"Assigning to a constant is not allowed.","lpp.error.assignOfConstant.detail":"Please note that you cannot assign a value to a constant.","lpp.error.invalidIndex.summary":"Invalid index.","lpp.error.invalidIndex.detail":"Please note that you cannot use complex objects like Array, Object or Function as index.","lpp.error.notCallable.summary":"Object is not callable.","lpp.error.notCallable.detail":"Please note that you can only call Function objects.","lpp.error.recursivePrototype.summary":"Recursive prototype is not allowed.","lpp.error.recursivePrototype.detail":"Please resolve recursive dependency.","lpp.error.uncaughtException.summary":"Uncaught exception.","lpp.error.uncaughtException.detail":"Please use try-catch block to catch exceptions or the code will stop execution.","lpp.error.uncaughtException.exception":"Exception:","lpp.error.uncaughtException.traceback":"Traceback:","lpp.error.releaseMode.summary":"The code encountered an error while running.","lpp.error.releaseMode.detail":"The program may not work as intended. Please contact project maintainers with this message for help.","lpp.error.blockNotFound":"Unable to find the block in Blockly workspace. The block might not belong to the target that you are currently editing.","lpp.error.position":"Position:","lpp.error.context":"Context:","lpp.error.self":"Self:","lpp.error.arguments":"Arguments:","lpp.error.hint":"For further information please check DevTools Console.","lpp.category.builtin":"Builtin","lpp.category.construct":"Construction","lpp.category.operator":"Operator","lpp.category.statement":"Statement","lpp.tooltip.builtin.type":"Predefined builtin data types. Includes everything which language feature requires.","lpp.tooltip.builtin.error":"Predefined builtin error types. Includes all errors which builtin classes throw.","lpp.tooltip.builtin.utility":"Predefined builtin utility types. Includes methods to process data.","lpp.tooltip.construct.literal":"Construct special literals in lpp.","lpp.tooltip.construct.Number":"Construct a Number object by Scratch literal.","lpp.tooltip.construct.String":"Construct a String object by Scratch literal.","lpp.tooltip.construct.Array":'Construct an Array object with specified structure. Use "+" to add or "-" to remove an element.',"lpp.tooltip.construct.Object":'Construct an Object object with specified structure. Use "+" to add or "-" to remove an element.',"lpp.tooltip.construct.Function":'Construct an Function object. Use "+" to add or "-" to remove an argument.',"lpp.tooltip.operator.get":"Get specified member of specified object.","lpp.tooltip.operator.binaryOp":"Do binary operations.","lpp.tooltip.operator.unaryOp":"Do unary operations.","lpp.tooltip.operator.call":'Call function with given arguments. Use "+" to add or "-" to remove an argument.',"lpp.tooltip.operator.new":'Construct an instance with given constructor and arguments. Use "+" to add or "-" to remove an argument.',"lpp.tooltip.operator.self":"Get the reference of self object in function context.","lpp.tooltip.operator.var":"Get the reference of a specified local variable or an argument.","lpp.tooltip.statement.return":"Return a value from the function.","lpp.tooltip.statement.throw":"Throw a value. It will interrupt current control flow immediately.","lpp.tooltip.statement.scope":"Create a lpp scope and execute the code in it.","lpp.tooltip.statement.try":"Try capturing exceptions in specified statements. If an exception is thrown, set the specified reference to error object, then execute exception handling code.","lpp.tooltip.statement.nop":"Does nothing. It is used to convert a Scratch reporter into a statement.","lpp.tooltip.button.close":"Close this hint.","lpp.tooltip.button.help.more":"Show detail.","lpp.tooltip.button.help.less":"Hide detail.","lpp.tooltip.button.scrollToBlockEnabled":"Scroll to this block.","lpp.tooltip.button.scrollToBlockDisabled":"Unable to find this block in project.","lpp.tooltip.button.nativeFn":"This is native function. For further information please check DevTools Console.","lpp.about.summary":"lpp is a high-level programming language developed by @FurryR.","lpp.about.github":"GitHub repository","lpp.about.afdian":"Sponsor","lpp.about.staff.1":"lpp developers staff","lpp.about.staff.2":"lpp won't be created without their effort."},"zh-cn":{"lpp.name":"lpp","lpp.block.construct.Number":"\u6570\u5B57","lpp.block.construct.String":"\u5B57\u7B26\u4E32","lpp.block.construct.Function":"\u51FD\u6570","lpp.block.operator.var":"\u53D8\u91CF","lpp.block.operator.self":"\u81EA\u8EAB","lpp.block.statement.return":"\u8FD4\u56DE","lpp.block.statement.throw":"\u629B\u51FA","lpp.block.statement.scope":"\u4F5C\u7528\u57DF","lpp.block.statement.try.1":"\u5C1D\u8BD5","lpp.block.statement.try.2":"\u6355\u83B7","lpp.error.useAfterDispose.summary":"\u65E0\u6CD5\u5728\u5DF2\u9500\u6BC1\u7684\u76EE\u6807\u4E0A\u64CD\u4F5C\u89D2\u8272\u3002","lpp.error.useAfterDispose.detail":"\u5982\u679C\u60A8\u8C03\u7528\u4E00\u4E2A\u5C5E\u4E8E\u5DF2\u9500\u6BC1\u89D2\u8272\u7684\u51FD\u6570\u5E76\u5728\u5176\u4E0A\u64CD\u4F5C\u89D2\u8272\uFF0C\u5219\u4F1A\u53D1\u751F\u6B64\u9519\u8BEF\u3002\u8BF7\u68C0\u67E5\u60A8\u7684\u4EE3\u7801\u3002","lpp.error.useOutsideFunction.summary":"\u65E0\u6CD5\u5728\u51FD\u6570\u4E4B\u5916\u4F7F\u7528\u6B64\u79EF\u6728\u3002","lpp.error.useOutsideFunction.detail":"\u5728\u51FD\u6570\u4E0A\u4E0B\u6587\u4E4B\u5916\u4F7F\u7528\u4E86\u51FD\u6570\u4E13\u7528\u7684\u79EF\u6728\u3002\u8BF7\u6CE8\u610F\u4E00\u5B9A\u8981\u5728\u51FD\u6570\u5185\u4F7F\u7528\u6B64\u7C7B\u79EF\u6728\u3002","lpp.error.useOutsideContext.summary":"\u65E0\u6CD5\u5728 lpp \u4E0A\u4E0B\u6587\u4EE5\u5916\u4F7F\u7528\u6B64\u79EF\u6728\u3002","lpp.error.useOutsideContext.detail":"\u65E0\u6CD5\u5728 lpp \u4E0A\u4E0B\u6587\u4EE5\u5916\u5BF9\u53D8\u91CF\u8FDB\u884C\u8BBF\u95EE\u3002\u8BF7\u9996\u5148\u4F7F\u7528\u4F5C\u7528\u57DF\u79EF\u6728\u6765\u521B\u5EFA\u4F5C\u7528\u57DF\u3002","lpp.error.syntaxError.summary":"\u79EF\u6728\u8BED\u6CD5\u9519\u8BEF\u3002","lpp.error.syntaxError.detail":"\u60A8\u9519\u8BEF\u5730\u4F7F\u7528\u4E86\u79EF\u6728\u3002\u8BF7\u6CE8\u610F lpp \u4E0D\u5141\u8BB8\uFF08\u5728\u4E0B\u6807\u8BBF\u95EE\u4EE5\u5916\u7684\u60C5\u51B5\u4E0B\uFF09\u76F4\u63A5\u4F7F\u7528 Scratch \u5B57\u9762\u91CF\u3002","lpp.error.accessOfNull.summary":"\u8BBF\u95EE\u4E86 null \u7684\u6210\u5458\u3002","lpp.error.accessOfNull.detail":"\u8BF7\u5728\u4F7F\u7528\u5BF9\u8C61\u524D\u68C0\u67E5\u5BF9\u8C61\u662F\u5426\u4E3A\u7A7A\u3002","lpp.error.assignOfConstant.summary":"\u5BF9\u5E38\u91CF\u8FDB\u884C\u4E86\u8D4B\u503C\u64CD\u4F5C\u3002","lpp.error.assignOfConstant.detail":"\u60A8\u53EF\u80FD\u6DF7\u6DC6\u4E86\u5DE6\u503C\u548C\u53F3\u503C\u3002\u8BF7\u6CE8\u610F\u60A8\u65E0\u6CD5\u5BF9\u53F3\u503C\u8FDB\u884C\u8D4B\u503C\u64CD\u4F5C\u3002","lpp.error.invalidIndex.summary":"\u5BF9\u8C61\u4E0B\u6807\u65E0\u6548\u3002","lpp.error.invalidIndex.detail":"\u8BF7\u6CE8\u610F\u8BF8\u5982 Array\uFF0CObject\uFF0CFunction \u7B49\u590D\u6742\u6570\u636E\u7C7B\u578B\u65E0\u6CD5\u4F5C\u4E3A\u4E0B\u6807\u4F7F\u7528\u3002","lpp.error.notCallable.summary":"\u5BF9\u8C61\u4E0D\u53EF\u8C03\u7528\u3002","lpp.error.notCallable.detail":"\u60A8\u4E0D\u53EF\u8C03\u7528\u9664\u4E86 Function \u7C7B\u578B\u4EE5\u5916\u7684\u5BF9\u8C61\u3002","lpp.error.recursivePrototype.summary":"\u5FAA\u73AF\u4F9D\u8D56 prototype \u4E0D\u88AB\u5141\u8BB8\u3002","lpp.error.recursivePrototype.detail":"\u8BF7\u89E3\u51B3\u5FAA\u73AF\u4F9D\u8D56\u3002","lpp.error.uncaughtException.summary":"\u6709\u672A\u88AB\u6355\u83B7\u7684\u5F02\u5E38\u3002","lpp.error.uncaughtException.detail":"\u8BF7\u4F7F\u7528\u5C1D\u8BD5/\u6355\u83B7\u79EF\u6728\u5BF9\u9519\u8BEF\u8FDB\u884C\u6355\u83B7\uFF0C\u5426\u5219\u4EE3\u7801\u5C06\u7EC8\u6B62\u8FD0\u884C\u3002","lpp.error.uncaughtException.exception":"\u9519\u8BEF\u5185\u5BB9\uFF1A","lpp.error.uncaughtException.traceback":"\u6808\u56DE\u6EAF\uFF1A","lpp.error.releaseMode.summary":"\u4EE3\u7801\u5728\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF\u3002","lpp.error.releaseMode.detail":"\u7A0B\u5E8F\u53EF\u80FD\u65E0\u6CD5\u6309\u9884\u671F\u6B63\u5E38\u8FD0\u884C\u3002\u8BF7\u8054\u7CFB\u9879\u76EE\u7EF4\u62A4\u8005\u4EE5\u83B7\u5F97\u5E2E\u52A9\u3002\u8BF7\u6CE8\u610F\u540C\u65F6\u9644\u4E0A\u6B64\u6D88\u606F\u3002","lpp.error.blockNotFound":"\u65E0\u6CD5\u5728 Blockly \u5DE5\u4F5C\u533A\u4E2D\u627E\u5230\u79EF\u6728\u3002\u8BE5\u79EF\u6728\u53EF\u80FD\u5E76\u4E0D\u5C5E\u4E8E\u5F53\u524D\u6B63\u7F16\u8F91\u7684\u89D2\u8272\u3002","lpp.error.position":"\u4F4D\u7F6E\uFF1A","lpp.error.context":"\u4E0A\u4E0B\u6587\uFF1A","lpp.error.self":"\u81EA\u8EAB\uFF1A","lpp.error.arguments":"\u53C2\u6570\uFF1A","lpp.error.hint":"\u8BE6\u7EC6\u5185\u5BB9\u5728 DevTools Console \u5185\u3002","lpp.category.builtin":"\u5185\u5D4C","lpp.category.construct":"\u6784\u9020","lpp.category.operator":"\u8FD0\u7B97","lpp.category.statement":"\u8BED\u53E5","lpp.tooltip.builtin.type":"\u9884\u5B9A\u4E49\u7684\u5185\u5D4C\u6570\u636E\u7C7B\u578B\u3002\u5305\u542B\u4E86\u8BED\u8A00\u7279\u6027\u6240\u9700\u8981\u7684\u5168\u90E8\u7C7B\u3002","lpp.tooltip.builtin.error":"\u9884\u5B9A\u4E49\u7684\u5185\u5D4C\u9519\u8BEF\u7C7B\u578B\u3002\u5305\u542B\u4E86\u8BED\u8A00\u5185\u5D4C\u7C7B\u4F1A\u629B\u51FA\u7684\u5168\u90E8\u9519\u8BEF\u3002","lpp.tooltip.builtin.utility":"\u9884\u5B9A\u4E49\u7684\u5B9E\u7528\u5DE5\u5177\u7C7B\u578B\u3002\u5305\u542B\u4E86\u5904\u7406\u6570\u636E\u9700\u8981\u7684\u5404\u79CD\u65B9\u6CD5\u3002","lpp.tooltip.construct.literal":"\u6784\u9020 lpp \u4E2D\u7279\u6B8A\u7684\u5B57\u9762\u91CF\u3002","lpp.tooltip.construct.Number":"\u4EE5 Scratch \u5B57\u9762\u91CF\u6784\u9020\u4E00\u4E2A Number \u5BF9\u8C61\u3002","lpp.tooltip.construct.String":"\u4EE5 Scratch \u5B57\u9762\u91CF\u6784\u9020\u4E00\u4E2A String \u5BF9\u8C61\u3002","lpp.tooltip.construct.Array":"\u4EE5\u6307\u5B9A\u7ED3\u6784\u6784\u9020 Array \u5BF9\u8C61\u3002\u53EF\u4F7F\u7528\u201C+\u201D\u6216\u201C-\u201D\u5BF9\u5143\u7D20\u8FDB\u884C\u589E\u51CF\u3002","lpp.tooltip.construct.Object":"\u4EE5\u6307\u5B9A\u7ED3\u6784\u6784\u9020 Object \u5BF9\u8C61\u3002\u53EF\u4F7F\u7528\u201C+\u201D\u6216\u201C-\u201D\u5BF9\u5143\u7D20\u8FDB\u884C\u589E\u51CF\u3002","lpp.tooltip.construct.Function":"\u6784\u9020 Function \u5BF9\u8C61\u3002\u53EF\u4F7F\u7528\u201C+\u201D\u6216\u201C-\u201D\u5BF9\u53C2\u6570\u8FDB\u884C\u589E\u51CF\u3002","lpp.tooltip.operator.get":"\u83B7\u5F97\u5BF9\u8C61\u4E0B\u7684\u67D0\u4E2A\u6210\u5458\u3002","lpp.tooltip.operator.binaryOp":"\u8FDB\u884C\u4E8C\u5143\u8FD0\u7B97\u3002","lpp.tooltip.operator.unaryOp":"\u8FDB\u884C\u4E00\u5143\u8FD0\u7B97\u3002","lpp.tooltip.operator.call":"\u4EE5\u7ED9\u5B9A\u7684\u53C2\u6570\u8C03\u7528\u51FD\u6570\u3002\u53EF\u4F7F\u7528\u201C+\u201D\u6216\u201C-\u201D\u5BF9\u53C2\u6570\u8FDB\u884C\u589E\u51CF\u3002","lpp.tooltip.operator.new":"\u4EE5\u6307\u5B9A\u7684\u53C2\u6570\u548C\u6784\u9020\u5668\u6784\u9020\u4E00\u4E2A\u5B9E\u4F8B\u3002\u53EF\u4F7F\u7528\u201C+\u201D\u6216\u201C-\u201D\u5BF9\u53C2\u6570\u8FDB\u884C\u589E\u51CF\u3002","lpp.tooltip.operator.self":"\u83B7\u5F97 Function \u5BF9\u8C61\u4E0A\u4E0B\u6587\u4E2D\u81EA\u8EAB\u7684\u5F15\u7528\u3002","lpp.tooltip.operator.var":"\u83B7\u5F97\u5F53\u524D\u4F5C\u7528\u57DF\u4E2D\u5C40\u90E8\u53D8\u91CF\u6216\u53C2\u6570\u7684\u5F15\u7528\u3002","lpp.tooltip.statement.return":"\u4ECE\u51FD\u6570\u8FD4\u56DE\u4E00\u4E2A\u503C\u3002","lpp.tooltip.statement.throw":"\u629B\u51FA\u4E00\u4E2A\u503C\u3002\u8FD9\u5C06\u7ACB\u5373\u4E2D\u65AD\u5F53\u524D\u63A7\u5236\u6D41\u3002","lpp.tooltip.statement.scope":"\u65B0\u5EFA lpp \u4F5C\u7528\u57DF\uFF0C\u5E76\u5728\u4F5C\u7528\u57DF\u5185\u6267\u884C\u4EE3\u7801\u3002","lpp.tooltip.statement.try":"\u5C1D\u8BD5\u5728\u6307\u5B9A\u7684\u8BED\u53E5\u5757\u4E2D\u6355\u83B7\u9519\u8BEF\u3002\u82E5\u6709\u9519\u8BEF\u88AB\u629B\u51FA\uFF0C\u5C06\u6307\u5B9A\u7684\u53D8\u91CF\u5F15\u7528\u8D4B\u503C\u4E3A\u9519\u8BEF\u5BF9\u8C61\uFF0C\u7136\u540E\u6267\u884C\u9519\u8BEF\u5904\u7406\u4EE3\u7801\u3002","lpp.tooltip.statement.nop":"\u65E0\u4EFB\u4F55\u6548\u679C\u3002\u7528\u4E8E\u5C06\u8FD4\u56DE\u503C\u79EF\u6728\u8F6C\u6362\u4E3A\u8BED\u53E5\u3002","lpp.tooltip.button.close":"\u5173\u95ED\u8FD9\u4E2A\u63D0\u793A\u3002","lpp.tooltip.button.help.more":"\u663E\u793A\u8BE6\u7EC6\u4FE1\u606F\u3002","lpp.tooltip.button.help.less":"\u9690\u85CF\u8BE6\u7EC6\u4FE1\u606F\u3002","lpp.tooltip.button.scrollToBlockEnabled":"\u8F6C\u5230\u8FD9\u4E2A\u79EF\u6728\u3002","lpp.tooltip.button.scrollToBlockDisabled":"\u65E0\u6CD5\u5728\u9879\u76EE\u4E2D\u627E\u5230\u6B64\u79EF\u6728\u3002","lpp.tooltip.button.nativeFn":"\u8FD9\u662F\u539F\u751F\u51FD\u6570\u3002\u8BE6\u7EC6\u5185\u5BB9\u5728 DevTools Console \u5185\u3002","lpp.about.summary":"lpp \u662F\u7531 @FurryR \u5F00\u53D1\u7684\u9AD8\u7EA7\u7A0B\u5E8F\u8BBE\u8BA1\u8BED\u8A00\u3002","lpp.about.github":"\u672C\u9879\u76EE\u7684 GitHub \u4ED3\u5E93","lpp.about.afdian":"\u8D5E\u52A9\u8005","lpp.about.staff.1":"lpp \u5F00\u53D1\u8005\u540D\u5355","lpp.about.staff.2":"\u5982\u679C\u6CA1\u6709\u4ED6/\u5979\u4EEC\uFF0Clpp \u5C06\u4E0D\u590D\u5B58\u5728\u3002"}};function v(o){return o instanceof E?o.value:o}function B(o){if(o instanceof w){if(o.value===null)return!1;switch(typeof o.value){case"number":return o.value!==0;case"boolean":return o.value;case"string":return o.value.length!==0}return!1}else{if(o instanceof j)return o.value.length!==0;if(o instanceof k)return o.value.size!==0;if(o instanceof b)return!0}return!1}function rt(o,s,n){if(!(o instanceof w&&n instanceof w))return NaN;let i=typeof o.value=="boolean"?+o.value:o.value,l=typeof n.value=="boolean"?+n.value:n.value,t=new Map([["+",(r,e)=>r+e],["-",(r,e)=>r-e],["*",(r,e)=>r*e],["/",(r,e)=>r/e],["<<",(r,e)=>r<<e],[">>",(r,e)=>r>>e],[">>>",(r,e)=>r>>>e],["&",(r,e)=>r&e],["|",(r,e)=>r|e],["^",(r,e)=>r^e]]).get(s);if(!t)throw new Error("lpp: not implemented");return t(i,l)}function G(o,s){return o=o instanceof w&&typeof o.value=="boolean"?new w(+o.value):o,s=s instanceof w&&typeof s.value=="boolean"?new w(+s.value):s,o instanceof w&&s instanceof w?o.value===s.value:o===s}function it(o,s,n){function i(t,r,e){if(r instanceof w){if(e instanceof w){if(r.value===null||e.value===null)return!1;switch(typeof r.value){case"boolean":switch(typeof e.value){case"boolean":return t(+r.value,+e.value);case"number":return t(+r.value,e.value);case"string":return t(+r.value,e.value.length?1:0);default:throw new Error("lpp: unknown rhs")}case"number":switch(typeof e.value){case"boolean":return t(r.value,+e.value);case"number":return t(r.value,e.value);case"string":return t(r.value?1:0,e.value.length?1:0);default:throw new Error("lpp: unknown rhs")}case"string":switch(typeof e.value){case"boolean":return t(r.value.length?1:0,+e.value);case"number":return t(r.value.length?1:0,e.value?1:0);case"string":return t(r.value,e.value);default:throw new Error("lpp: unknown rhs")}default:throw new Error("lpp: unknown lhs")}}return i(t,r,new w(B(e)))}return i(t,new w(B(r)),e)}let a=new Map([[">",(t,r)=>t>r],["<",(t,r)=>t<r],[">=",(t,r)=>t>=r],["<=",(t,r)=>t<=r]]).get(s);if(!a)throw new Error("lpp: not implemented");return i(a,o,n)}function Y(o){let s=new WeakMap;function n(i){if(i instanceof w)return i.value;if(i instanceof j){let l=s.get(i);if(l)return l;let a=i.value.map(t=>t?Y(t):null);return s.set(i,a),a}if(i instanceof k){let l=s.get(i);if(l)return l;let a={};for(let[t,r]of i.value.entries())t!=="constructor"&&(a[t]=Y(r));return s.set(i,a),a}return null}return n(o)}function X(o){let s=new WeakMap;function n(i){if(i==null)return new w(null);switch(typeof i){case"string":case"number":case"boolean":return new w(i);case"object":{let l=s.get(i);if(l)return l;if(i instanceof globalThis.Array){let t=new j(i.map(r=>n(r)));return s.set(i,t),t}let a=new k;for(let[t,r]of globalThis.Object.entries(i))a.set(t,n(r));return s.set(i,a),a}}return new w(null)}return n(o)}var M=class extends Error{constructor(n){super(`lpp: Error ${n}`);this.id=n}},N=class{},E=class{constructor(s,n,i){this.name=n;this.value=i;this.parent=new WeakRef(s)}parent;get(s){return this.value.get(s)}set(s,n){return this.value.set(s,n)}has(s){return this.value.has(s)}delete(s){let n=this.parent.deref();if(!n)throw new M("assignOfConstant");return s?this.value.delete(s):n.delete(this.name)}instanceof(s){return this.value.instanceof(s)}assign(s){let n=this.parent.deref();if(!n)throw new M("assignOfConstant");return n.set(this.name,s),this.value=s,this}toString(){return this.value.toString()}calc(s,n){return s==="="&&n?this.assign(n):s==="delete"&&!n?new w(this.delete()):this.value.calc(s,n)}};function Q(o,s){let n=new WeakSet;function i(l,a){if(l instanceof k){let t=l.value.get(a);if(t)return t;{let r=l.value.get("prototype");if(r instanceof k){if(n.has(r))throw new M("recursivePrototype");return n.add(r),Q(r,a)}}}return null}return i(o,s)}function yt(o,s){if(o===s)return!0;if(o.value.has("prototype")){let n=o.value.get("prototype");if(n instanceof k)return yt(n,s)}return!1}var w=class o extends N{constructor(n){super();this._value=n}get value(){return this._value}get(n){if(this.value===null)throw new M("accessOfNull");if(n==="constructor")switch(typeof this.value){case"string":return C.get("String")??new o(null);case"number":return C.get("Number")??new o(null);case"boolean":return C.get("Boolean")??new o(null)}else{if(n==="prototype")return new o(null);{if(typeof this.value=="string"){let t=parseInt(n);if(!isNaN(t)){let r=this.value[t];return r!==void 0?new o(r):new o(null)}}let i=v(this.get("constructor"));if(!(i instanceof b))throw new Error("lpp: unexpected constructor -- must be a LppFunction instance");let l=v(i.get("prototype"));if(!(l instanceof k))throw new Error("lpp: unexpected prototype -- must be a LppObject instance");let a=Q(l,n);return a===null?new o(null):new E(this,n,a)}}}set(){throw new M("assignOfConstant")}has(n){if(this.value===null)throw new M("accessOfNull");if(n==="constructor")return!0;let i=v(this.get("constructor"));if(!(i instanceof b))throw new Error("lpp: unexpected constructor -- must be a LppFunction instance");let l=v(i.get("prototype"));if(!(l instanceof k))throw new Error("lpp: unexpected prototype -- must be a LppObject instance");return Q(l,n)!==null}delete(){throw this.value===null?new M("accessOfNull"):new M("assignOfConstant")}instanceof(n){if(this.value===null)return!1;switch(typeof this.value){case"string":return n===C.get("String");case"number":return n===C.get("Number");case"boolean":return n===C.get("Boolean")}}toString(){return`${this.value}`}calc(n,i){if(i)switch(n){case"=":throw new M("assignOfConstant");case"+":return this.value!==null&&i instanceof o&&i.value!==null?new o(rt(this,n,i)):new o(NaN);case"*":{if(this.value!==null){if(i instanceof o){if(typeof this.value=="string"&&typeof i.value=="number"){if(Number.isInteger(i.value))return new o(this.value.repeat(i.value))}else if(typeof this.value=="number"&&typeof i.value=="string"&&Number.isInteger(this.value))return new o(i.value.repeat(this.value));return new o(rt(this,n,i))}else if(i instanceof j&&(typeof this.value=="boolean"||typeof this.value=="number")){let l=typeof this.value=="boolean"?+this.value:this.value;if(Number.isInteger(l)){let a=new j;for(let t=0;t<l;t++)a.value=a.value.concat(i.value);return a}}}return new o(NaN)}case"==":return new o(G(this,i));case"!=":return new o(!G(this,i));case">":case"<":case">=":case"<=":return new o(it(this,n,i));case"&&":case"||":{let l=B(this),a=B(i);return new o(n==="&&"?l&&a:l||a)}case"-":case"/":case"%":case"<<":case">>":case">>>":case"&":case"|":case"^":return!(i instanceof o)||this.value===null||i.value===null||typeof this.value=="string"||typeof i.value=="string"?new o(NaN):new o(rt(this,n,i));case"instanceof":{if(i instanceof b)return new o(this.instanceof(i));throw new M("notCallable")}}else switch(n){case"delete":throw new M("assignOfConstant");case"+":return typeof this.value=="boolean"||typeof this.value=="number"||typeof this.value=="string"?new o(+this.value):new o(NaN);case"-":return typeof this.value=="boolean"||typeof this.value=="number"||typeof this.value=="string"?new o(-this.value):new o(NaN);case"!":return new o(!B(this));case"~":{if(!(typeof this.value=="boolean"||typeof this.value=="number"||typeof this.value=="string"))return new o(NaN);let l=+this.value;return isNaN(l)?new o(NaN):new o(~l)}}throw new Error("lpp: unknown operand")}},k=class o extends N{constructor(n=new Map,i){super();this.value=n;this.value=n??new Map,i&&this.value.set("constructor",i)}get(n){if(n==="constructor")return this.value.get(n)??C.get("Object")??new w(null);{let i=this.value.get(n);if(i||n=="prototype")return new E(this,n,i??new w(null));let l=v(this.get("constructor"));if(!(l instanceof b))throw new Error("lpp: unexpected constructor -- must be a LppFunction instance");let a=v(l.get("prototype"));if(!(a instanceof o))throw new Error("lpp: unexpected prototype -- must be a LppObject instance");let t=Q(a,n);return t===null?new E(this,n,new w(null)):new E(this,n,t)}}set(n,i){return this.value.set(n,i),new E(this,n,i)}has(n){if(n==="constructor"||this.value.has(n))return!0;let i=v(this.get("constructor"));if(!(i instanceof b))throw new Error("lpp: unexpected constructor -- must be a LppFunction instance");let l=v(i.get("prototype"));if(!(l instanceof o))throw new Error("lpp: unexpected prototype -- must be a LppObject instance");return Q(l,n)!==null}delete(n){return this.value.delete(n)}instanceof(n){let i=this.get("constructor"),l=v(i.get("prototype")),a=v(n.get("prototype"));return l instanceof o&&a instanceof o?yt(l,a):!1}toString(){return"<Lpp Object>"}calc(n,i){if(i)switch(n){case"=":throw new M("assignOfConstant");case"+":{if(!(this instanceof b)&&i instanceof o&&!(i instanceof b)){if(this.value.has("constructor")||i.value.has("constructor"))return new w(NaN);let l=new o;for(let[a,t]of this.value.entries())l.set(a,t);for(let[a,t]of i.value.entries())l.set(a,t);return l}return new w(NaN)}case"==":return new w(G(this,i));case"!=":return new w(!G(this,i));case">":case"<":case">=":case"<=":return new w(it(this,n,i));case"&&":case"||":{let l=B(this),a=B(i);return new w(n==="&&"?l&&a:l||a)}case"instanceof":{if(i instanceof b)return new w(this.instanceof(i));throw new M("notCallable")}case"*":case"-":case"/":case"%":case"<<":case">>":case">>>":case"&":case"|":case"^":return new w(NaN)}else switch(n){case"delete":throw new M("assignOfConstant");case"!":return new w(!B(this));case"+":case"-":case"~":return new w(NaN)}throw new Error("lpp: unknown operand")}},j=class o extends N{constructor(n=[]){super();this.value=n}get(n){if(n==="constructor")return C.get("Array")??new w(null);{let i=parseInt(n,10);if(i>=0){let l=this.value[i];return l?new E(this,n,l):new E(this,n,new w(null))}else{let l=v(this.get("constructor"));if(!(l instanceof b))throw new Error("lpp: unexpected constructor -- must be a LppFunction instance");let a=v(l.get("prototype"));if(!(a instanceof k))throw new Error("lpp: unexpected prototype -- must be a LppObject instance");let t=Q(a,n);if(t===null)throw new M("invalidIndex");return new E(this,n,t)}}}set(n,i){let l=parseInt(n,10);if(l>=0)return this.value[l]=i,new E(this,n,i);throw new M("invalidIndex")}has(n){if(n==="constructor")return!0;let i=parseInt(n,10);if(i>=0&&i in this.value)return!0;let l=v(this.get("constructor"));if(!(l instanceof b))throw new Error("lpp: unexpected constructor -- must be a LppFunction instance");let a=v(l.get("prototype"));if(!(a instanceof k))throw new Error("lpp: unexpected prototype -- must be a LppObject instance");return Q(a,n)!==null}delete(n){let i=parseInt(n,10);return i>=0&&i in this.value?(delete this.value[i],!0):!1}instanceof(n){return n===C.get("Array")}toString(){return"<Lpp Array>"}calc(n,i){if(i)switch(n){case"=":throw new M("assignOfConstant");case"+":return i instanceof o?new o(this.value.concat(i.value)):new w(NaN);case"*":{if(i instanceof w&&(typeof i.value=="boolean"||typeof i.value=="number")){let l=typeof i.value=="boolean"?+i.value:i.value;if(Number.isInteger(l)){let a=new o;for(let t=0;t<l;t++)a.value=a.value.concat(this.value);return a}}return new w(NaN)}case"==":return new w(G(this,i));case"!=":return new w(!G(this,i));case">":case"<":case">=":case"<=":return new w(it(this,n,i));case"&&":case"||":{let l=B(this),a=B(i);return new w(n==="&&"?l&&a:l||a)}case"instanceof":{if(i instanceof b)return new w(this.instanceof(i));throw new M("notCallable")}case"-":case"/":case"%":case"<<":case">>":case">>>":case"&":case"|":case"^":return new w(NaN)}else switch(n){case"delete":throw new M("assignOfConstant");case"!":return new w(!B(this));case"+":case"-":case"~":return new w(NaN)}throw new Error("lpp: unknown operand")}},b=class o extends k{constructor(n,i=new k){super(new Map,void 0);this.execute=n;this.value.set("prototype",i)}static native(n,i){function l(t,r,e,p){return t instanceof y&&t.pushStack(new H.NativeFn(r,e,p)),t}let a=new o((t,r)=>{let e=n(t,r);return e instanceof Promise?e.then(p=>l(p,a,t??new w(null),r)):l(e,a,t??new w(null),r)},i);return a}get(n){if(n==="constructor")return C.get("Function")??new w(null);if(n==="prototype"){let i=this.value.get(n);if(i)return i;throw new Error("lpp: unexpected get -- prototype is null")}else{let i=this.value.get(n);if(i)return new E(this,n,i);let l=v(this.get("constructor"));if(!(l instanceof o))throw new Error("lpp: unexpected constructor -- must be a LppFunction instance");let a=v(l.get("prototype"));if(!(a instanceof k))throw new Error("lpp: unexpected prototype -- must be a LppObject instance");let t=Q(a,n);return t===null?new E(this,n,new w(null)):new E(this,n,t)}}set(n,i){return this.value.set(n,i),new E(this,n,i)}has(n){if(n==="constructor"||this.value.has(n))return!0;let i=v(this.get("constructor"));if(!(i instanceof o))throw new Error("lpp: unexpected constructor -- must be a LppFunction instance");let l=v(i.get("prototype"));if(!(l instanceof k))throw new Error("lpp: unexpected prototype -- must be a LppObject instance");return Q(l,n)!==null}delete(n){if(n==="prototype")throw new M("assignOfConstant");return this.value.delete(n)}apply(n,i){return this.execute(n,i)}construct(n){if(this===C.get("Number")||this===C.get("String")||this===C.get("Boolean")||this===C.get("Array")||this===C.get("Function")||this===C.get("Object"))return this.apply(new w(null),n);let i=this===C.get("Promise")?new _:new k(new Map,this),l=this.apply(i,n),a=t=>t instanceof y?t:new x(i);return l instanceof Promise?l.then(t=>a(t)):a(l)}toString(){return"<Lpp Function>"}},_=class o extends k{pm;resolve;reject;done(s,n){function i(a,t){if(a instanceof x)return t.resolve(a.value);throw t.reject(a.value)}let l=new o;return this.pm.then(a=>{if(a instanceof N){let t=s.apply(this,[a]);return t instanceof Promise?t.then(r=>i(r,l)):i(t,l)}throw new Error("lpp: unknown result")},n?a=>{if(a instanceof N){let t=n.apply(this,[a]);return t instanceof Promise?t.then(r=>i(r,l)):i(t,l)}throw a}:void 0),l}error(s){function n(l,a){if(l instanceof x)return a.resolve(l.value);throw a.reject(l.value)}let i=new o;return this.pm.catch(l=>{if(l instanceof N){let a=s.apply(this,[l]);return a instanceof Promise?a.then(t=>n(t,i)):n(a,i)}throw l}),i}constructor(){let s=C.get("Promise");if(!(s instanceof b))throw new Error("lpp: not implemented");super(new Map,s),this.resolve=this.reject=()=>{throw new Error("lpp: unexpected call -- check if Promise satisfies A+ standard.")},this.pm=new Promise((n,i)=>{this.resolve=n,this.reject=i})}};var x=class{constructor(s){this.value=s;this.value=s}},y=class{constructor(s){this.value=s;this.stack=[]}stack;pushStack(s){this.stack.push(s)}},H;(n=>{class o{}n.Base=o;class s extends o{constructor(a,t,r){super();this.fn=a;this.self=t;this.args=r}toString(){return"<Native Function>"}}n.NativeFn=s})(H||={});var q=class extends N{value=new Map;get(s){return new E(this,s,this.value.get(s)??new w(null))}set(s,n){return this.value.set(s,n),new E(this,s,n)}has(s){return this.value.has(s)}delete(s){return this.value.delete(s)}instanceof(){throw new Error("lpp: invalid usage of instanceof on LppClosure")}toString(){return"<Lpp Closure>"}calc(){throw new Error("lpp: invalid usage of calc on LppClosure")}constructor(){super()}},W=class{constructor(s,n,i){this.parent=s;this._returnCallback=n;this._exceptionCallback=i;this.closure=new q,this.parent=s}closure=new q;exceptionCallback(s){this._exceptionCallback(s),this.clearCallbacks()}returnCallback(s){this._returnCallback(s),this.clearCallbacks()}get(s){return this.closure.has(s)?this.closure.get(s):this.parent?this.parent.get(s):this.closure.get(s)}clearCallbacks(){this._exceptionCallback=()=>{},this._returnCallback=()=>{}}unwind(){return this.parent?this.parent.unwind():null}},Z=class extends W{constructor(n,i,l,a){super(n,l,a);this.self=i}unwind(){return this}};var C=new Map,T;(u=>(u.Boolean=b.native((g,f)=>f.length<1?new x(new w(!1)):new x(new w(B(f[0]))),new k(new Map)),u.Number=b.native((g,f)=>{function h(c){if(c.length<1)return new w(0);let m=c[0];if(m instanceof w){if(m===new w(null))return new w(0);switch(typeof m.value){case"string":return new w(globalThis.Number(m.value));case"number":return new w(m.value);case"boolean":return m.value?new w(1):new w(0)}}else{if(m instanceof b)return new w(NaN);if(m instanceof k)return new w(NaN)}return new w(NaN)}return new x(h(f))},new k(new Map)),u.String=b.native((g,f)=>{function h(c){if(c.length<1)return new w("");let m=c[0];return new w(m.toString())}return new x(h(f))},new k(new Map([["length",b.native(g=>{if(g instanceof w&&typeof g.value=="string")return new x(new w(g.value.length));let f=u.IllegalInvocationError.construct([]);if(f instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return f instanceof y?f:new y(f.value)})]]))),u.Array=b.native((g,f)=>{function h(c){return c.length<1?new j:c.length===1&&c[0]instanceof j?c[0]:new j(c)}return new x(h(f))},new k(new Map([["length",b.native(g=>{if(g instanceof j)return new x(new w(g.value.length));let f=u.IllegalInvocationError.construct([]);if(f instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return f instanceof y?f:new y(f.value)})]]))),u.Object=b.native((g,f)=>{function h(c){return c.length<1?new k:c[0]}return new x(h(f))},new k(new Map)),u.Function=b.native((g,f)=>{if(f.length<1)return new x(new b(()=>new x(new w(null))));if(f[0]instanceof b)return new x(f[0]);let h=u.IllegalInvocationError.construct([]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return h instanceof y?h:new y(h.value)},new k(new Map([["prototype",v(u.Object.get("prototype"))],["apply",b.native((g,f)=>{if(g instanceof b){let h=new w(null),c=[];switch(f.length){case 0:break;case 1:{h=f[0];break}default:{if(!(f[1]instanceof j)){let m=u.IllegalInvocationError.construct([]);if(m instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return m instanceof y?m:new y(m.value)}h=f[0],c=f[1].value.map(m=>m??new w(null));break}}return g.apply(h,c)}else{let h=u.IllegalInvocationError.construct([]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return h instanceof y?h:new y(h.value)}})]]))),u.Promise=b.native((g,f)=>{if(g instanceof _&&f.length>0&&f[0]instanceof b)return f[0].apply(g,[new b((c,m)=>(g.resolve(m[0]??new w(null)),new x(new w(null)))),new b((c,m)=>(g.reject(m[0]??new w(null)),new x(new w(null))))]);{let h=u.IllegalInvocationError.construct([]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return h instanceof y?h:new y(h.value)}},new k(new Map([["then",b.native((g,f)=>{if(g instanceof _&&f.length>0&&f[0]instanceof b)return new x(g.done(f[0],f[1]instanceof b?f[1]:void 0));{let h=u.IllegalInvocationError.construct([]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return h instanceof y?h:new y(h.value)}})],["catch",b.native((g,f)=>{if(g instanceof _&&f.length>0&&f[0]instanceof b)return new x(g.error(f[0]));{let h=u.IllegalInvocationError.construct([]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return h instanceof y?h:new y(h.value)}})]]))),u.Error=b.native((g,f)=>{if(g.instanceof(u.Error))return g.set("value",f[0]??new w(null)),g.set("stack",new w(null)),new x(new j);{let h=u.IllegalInvocationError.construct([]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return h instanceof y?h:new y(h.value)}},new k(new Map)),u.IllegalInvocationError=b.native((g,f)=>{if(g.instanceof(u.IllegalInvocationError)){let h=u.Error.apply(g,f);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: Error constructor should be synchronous");return h instanceof y?h:new x(new w(null))}else{let h=u.IllegalInvocationError.construct([]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return h instanceof y?h:new y(h.value)}},new k(new Map([["prototype",v(u.Error.get("prototype"))]]))),u.SyntaxError=b.native((g,f)=>{if(g.instanceof(u.SyntaxError)){let h=u.Error.apply(g,f);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: Error constructor should be synchronous");return h instanceof y?h:new x(new w(null))}else{let h=u.IllegalInvocationError.construct([]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return h instanceof y?h:new y(h.value)}},new k(new Map([["prototype",v(u.Error.get("prototype"))]]))),u.JSON=new k(new Map([["parse",b.native((g,f)=>{if(g!=u.JSON){let h=u.IllegalInvocationError.construct([]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return h instanceof y?h:new y(h.value)}if(f.length<1||!(f[0]instanceof w)||typeof f[0].value!="string"){let h=u.SyntaxError.construct([new w("Invalid JSON")]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: SyntaxError constructor should be synchronous");return h instanceof y?h:new y(h.value)}try{return new x(X(globalThis.JSON.parse(f[0].value)))}catch(h){if(h instanceof globalThis.Error){let c=u.SyntaxError.construct([new w(h.message)]);if(c instanceof globalThis.Promise)throw new globalThis.Error("lpp: SyntaxError constructor should be synchronous");return c instanceof y?c:new y(c.value)}else throw h}})],["stringify",b.native((g,f)=>{if(g!=u.JSON){let h=u.IllegalInvocationError.construct([]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return h instanceof y?h:new y(h.value)}if(f.length<1){let h=u.SyntaxError.construct([new w("Invalid value")]);if(h instanceof globalThis.Promise)throw new globalThis.Error("lpp: SyntaxError constructor should be synchronous");return h instanceof y?h:new y(h.value)}try{return new x(new w(globalThis.JSON.stringify(Y(f[0]))))}catch(h){if(h instanceof globalThis.Error){let c=u.SyntaxError.construct([new w(h.message)]);if(c instanceof globalThis.Promise)throw new globalThis.Error("lpp: SyntaxError constructor should be synchronous");return c instanceof y?c:new y(c.value)}else throw h}})]]))))(T||={});C.set("Boolean",T.Boolean);C.set("Number",T.Number);C.set("String",T.String);C.set("Array",T.Array);C.set("Object",T.Object);C.set("Function",T.Function);C.set("Promise",T.Promise);C.set("Error",T.Error);C.set("IllegalInvocationError",T.IllegalInvocationError);C.set("SyntaxError",T.SyntaxError);C.set("JSON",T.JSON);var A={};Lt(A,{CloseIcon:()=>lt,Div:()=>Ct,HelpIcon:()=>at,IconGroup:()=>pt,Text:()=>ut,Title:()=>ct,globalStyle:()=>tt,show:()=>st});function st(o,s,n,i){let l=o.getMainWorkspace(),a=l.getBlockById(s);if(!a)return;o.DropDownDiv.hideWithoutAnimation(),o.DropDownDiv.clearContent();let t=o.DropDownDiv.getContentDiv(),r=document.createElement("div");return r.setAttribute("class","valueReportBox"),r.append(...n),r.style.minWidth="none",r.style.minHeight="none",r.style.maxWidth="none",r.style.maxHeight="none",r.style.textAlign=i,r.style.userSelect="none",t.appendChild(r),o.DropDownDiv.setColour(o.Colours.valueReportBackground,o.Colours.valueReportBorder),o.DropDownDiv.showPositionedByBlock(l,a),r}function pt(o){let s=document.createElement("div");return s.style.float="right",s.append(...o),s}function lt(o,s){let n=document.createElement("span");return n.classList.add("lpp-traceback-icon"),n.addEventListener("click",()=>{o.DropDownDiv.hide()}),n.title=`\u274C ${s}`,n.textContent="\u274C",n}function at(o,s,n,i){let l=!1,a=document.createElement("span");return a.classList.add("lpp-traceback-icon"),a.textContent="\u2753",a.title=`\u2753 ${o}`,a.addEventListener("click",()=>{l?(a.textContent="\u2753",a.title=`\u2753 ${o}`,i()):(a.textContent="\u2796",a.title=`\u2796 ${s}`,n()),l=!l}),a}function ct(o){let s=document.createElement("div");return s.style.textAlign="left",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis",s.title=s.textContent=o,s}function ut(o,s){let n=document.createElement("span");return s&&(n.className=s),n.textContent=o,n}function Ct(o,s){let n=document.createElement("div");return s&&(n.className=s),n.append(...o),n}var tt=document.createElement("style");tt.textContent=`
.lpp-traceback-icon {
  transition: text-shadow 0.25s ease-out;
  color: transparent;
  text-shadow: 0 0 0 gray;
}
.lpp-traceback-icon:hover {
  cursor: pointer;
  text-shadow: 0 0 0 gray, 0px 0px 5px silver;
}
`;document.head.appendChild(tt);var z;(i=>{i.Base=H.Base,i.NativeFn=H.NativeFn;class n extends H.Base{constructor(t,r,e){super();this.target=t;this.block=r;this.context=e}toString(){return this.block}}i.Block=n})(z||={});var gt={};Lt(gt,{Validator:()=>ht,attachMetadata:()=>et,attachTypehint:()=>dt,deserializeBlock:()=>wt,hasMetadata:()=>J,serializeBlock:()=>ft});function et(o,s,n,i,l){let a=o;a.target=s,a.blocks=n,a.block=i,a.signature=l,a.isTypehint=!1}function dt(o,s){let n=o;n.signature=s,n.isTypehint=!0}function J(o){let s=o;return(s.block===void 0||typeof s.block=="string")&&(s.target===void 0||typeof s.target=="string")&&s.signature instanceof Array&&s.signature.every(n=>typeof n=="string")&&typeof s.isTypehint=="boolean"}function ft(o,s){function n(l,a){let t={};t[a.id]=structuredClone(a);for(let r of Object.values(a.inputs)){let e=l.getBlock(r.block);e&&Object.assign(t,n(l,e))}if(a.next){let r=l.getBlock(a.next);r&&Object.assign(t,n(l,r))}return t}let i=n(o,s);return i[s.id].parent=null,i}function wt(o,s){o._blocks=s}var ht;(l=>{function o(a){if(!(a instanceof Object))return!1;let t=a;return!(t.id!==null&&typeof t.id!="string"||typeof t.name!="string"||typeof t.value!="string")}l.isField=o;function s(a,t){if(!(t instanceof Object))return!1;let r=t;return!(r.shadow!==null&&typeof r.shadow!="string"||typeof r.name!="string"||typeof r.block!="string"||!(r.block in a))}l.isInput=s;function n(a,t,r){if(!(r instanceof Object))return!1;let e=r;return!(e.id!==t||typeof e.opcode!="string"||e.parent!==null&&(typeof e.parent!="string"||!(e.parent in a)||e.parent===t)||e.next!==null&&(typeof e.next!="string"||!(e.next in a)||e.next===t)||typeof e.shadow!="boolean"||typeof e.topLevel!="boolean"||!(e.inputs instanceof Object)||!Object.values(e.inputs).every(p=>s(a,p))||!(e.fields instanceof Object)||!Object.values(e.fields).every(p=>o(p))||e.mutation!==void 0&&!(e.mutation instanceof Object))}l.isBlock=n;function i(a){if(!(a instanceof Object))return!1;let t=a;return!(!(t.signature instanceof Array)||!t.signature.every(r=>typeof r=="string")||!(t.script instanceof Object)||!Object.entries(t.script).every(r=>n(t.script,r[0],r[1]))||t.block!==null&&(typeof t.block!="string"||!(t.block in t.script)))}l.isInfo=i})(ht||={});function nt(o,s,n,i){function l(t,r,e,p){let d=!1,u=document.createElement("span");return u.classList.add("lpp-traceback-icon"),u.textContent="\u2795",u.title=`\u2795 ${t}`,u.addEventListener("click",()=>{d?(u.textContent="\u2795",u.title=`\u2795 ${t}`,p()):(u.textContent="\u2796",u.title=`\u2796 ${r}`,e()),d=!d}),u}function a(t){function r(d,u,g){let f=document.createElement("li");return f.append(g?A.Text(d,"lpp-code lpp-inspector-number lpp-inspector-key"):/^[$_a-zA-Z][$_0-9a-zA-Z]*$/.test(d)?A.Text(d,`lpp-code lpp-inspector-key${["constructor","prototype"].includes(String(d))?`-${d}`:""}`):A.Text(JSON.stringify(d),"lpp-code lpp-inspector-string lpp-inspector-key"),A.Text(" \u27A1\uFE0F ")),f.append(nt(o,s,n,u)),f}let e=t instanceof b&&J(t),p=document.createElement("ul");p.classList.add("lpp-list");for(let[d,u]of t.value.entries())(!(t instanceof b)||d!=="prototype")&&d!=="constructor"&&p.append(r(String(d),u??new w(null),t instanceof j));if(t instanceof b&&p.append(r("prototype",t.value.get("prototype")??new w(null),!1)),(t instanceof j||t instanceof b||t instanceof k)&&p.append(r("constructor",t instanceof j?T.Array:t.value.get("constructor")??(t instanceof b?T.Function:T.Object),!1)),e&&!t.isTypehint){let d=document.createElement("li");d.append(A.Text("[[FunctionLocation]]","lpp-code lpp-inspector-key-constructor"),A.Text(" \u27A1\uFE0F "));let u=document.createElement("span");if(u.classList.add("lpp-code"),t.target&&t.block&&s.runtime.getTargetById(t.target)){let g=o.getMainWorkspace();u.classList.add("lpp-traceback-stack-enabled");let{target:f,block:h}=t;u.textContent=h,u.title=n("lpp.tooltip.button.scrollToBlockEnabled"),u.addEventListener("click",()=>{let c=o.DropDownDiv.getContentDiv().getElementsByClassName("valueReportBox")[0];s.setEditingTarget(f),g.centerOnBlock(h,!0),o.DropDownDiv.hideWithoutAnimation(),o.DropDownDiv.clearContent(),o.DropDownDiv.getContentDiv().append(c),o.DropDownDiv.showPositionedByBlock(g,g.getBlockById(h))})}else u.classList.add("lpp-inspector-null"),u.textContent="null";d.append(u),p.append(d)}return p}if(i instanceof w){if(i.value===null)return A.Text("null","lpp-code lpp-inspector-null");switch(typeof i.value){case"boolean":case"number":return A.Text(String(i.value),"lpp-code lpp-inspector-number");case"string":return A.Text(JSON.stringify(i.value),"lpp-code lpp-inspector-string")}}else if(i instanceof j||i instanceof k||i instanceof b){let t,r=l(n("lpp.tooltip.button.help.more"),n("lpp.tooltip.button.help.less"),()=>{t?t.style.display="block":e.appendChild(t=a(i))},()=>{t&&(t.style.display="none")}),e=document.createElement("span");e.style.lineHeight="80%";let p;if(i instanceof j?p=A.Text(i.value.length===0?"[]":"[...]","lpp-code"):i instanceof b?(p=A.Text(`f (${J(i)?i.signature.join(", "):""})`,"lpp-code"),p.style.fontStyle="italic"):p=A.Text(i.value.size===0?"{}":"{...}","lpp-code"),i instanceof b&&J(i)&&i.target&&i.block&&s.runtime.getTargetById(i.target)){let d=o.getMainWorkspace(),{target:u,block:g}=i;p.title=n("lpp.tooltip.button.scrollToBlockEnabled"),p.classList.add("lpp-traceback-stack-enabled"),p.addEventListener("click",()=>{let f=o.DropDownDiv.getContentDiv().getElementsByClassName("valueReportBox")[0];s.setEditingTarget(u),d.centerOnBlock(g,!0),o.DropDownDiv.hideWithoutAnimation(),o.DropDownDiv.clearContent(),o.DropDownDiv.getContentDiv().append(f),o.DropDownDiv.showPositionedByBlock(d,d.getBlockById(g))})}else p.addEventListener("click",()=>{r.click()});return e.append(r,A.Text(" "),p),e}throw new Error("lpp: unknown value")}A.globalStyle.textContent+=`
.lpp-inspector-null {
  color: gray;
  user-select: text;
}
.lpp-inspector-key {
  font-weight: bold;
  user-select: text;
}
.lpp-inspector-key-prototype {
  font-weight: bold;
  color: gray;
  user-select: text;
}
.lpp-inspector-key-constructor {
  color: gray;
  user-select: text;
}
.lpp-inspector-number {
  color: blue;
  user-select: text;
}
.lpp-inspector-string {
  color: green;
  user-select: text;
}
`;var K;function ot({title:o,body:s,tag:n,silent:i}){Notification.requestPermission().then(l=>{l==="granted"&&(K?(K.close(),K=void 0,setTimeout(()=>ot({title:o,body:s,tag:n,silent:i}))):(K=new Notification(o,{body:s,tag:n,silent:i}),K.addEventListener("close",()=>{K=void 0})))})}function Mt(o){let s=document.getElementById("tmpSVGContainer"),n=o.outerHTML.replace(/&nbsp;/g," ");s||(s=document.createElement("div"),s.id="tmpSVGContainer",s.innerHTML='<svg id="tmpSVG" xmlns="http://www.w3.org/2000/svg" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="blocklySvg"><style type="text/css" ><![CDATA[.blocklyDraggable{font-family: "Helvetica Neue", Helvetica, sans-serif;font-size: 12pt;font-weight: 500;}.blocklyText {fill: #fff;box-sizing: border-box;}.blocklyEditableText .blocklyText{fill: #000;}.blocklyDropdownText.blocklyText{fill: #fff;}]]></style><g id="tmpSVGContent"></g></svg>',document.body.appendChild(s));let i=document.getElementById("tmpSVGContent");if(i&&i instanceof SVGGElement){i.innerHTML=n,i.children[0].setAttribute("transform","");let l=i.children[0].getAttribute("data-shapes")??"",a=l.includes("hat"),t=l!=="hat"&&a,r=i.getBBox(),e=a?18:0;e=t?21:e;let p=Math.max(750,r.width+1),d=r.height+e,u=document.getElementById("tmpSVG");if(u){u.setAttribute("width",p.toString()),u.setAttribute("height",d.toString()),u.setAttribute("viewBox",`-1 ${a?-e:0} ${p} ${d}`);let g=u.outerHTML;g=(g=(g=(g=(g=g.replace(/"[\S]+?dropdown-arrow\.svg"/gm,'"data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4="')).replace(/"[\S]+?green-flag\.svg"/gm,'"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIxLjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ImdyZWVuZmxhZyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiCgkgdmlld0JveD0iMCAwIDI0IDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiM0NTk5M0Q7fQoJLnN0MXtmaWxsOiM0Q0JGNTY7fQo8L3N0eWxlPgo8dGl0bGU+Z3JlZW5mbGFnPC90aXRsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTIwLjgsMy43Yy0wLjQtMC4yLTAuOS0wLjEtMS4yLDAuMmMtMiwxLjYtNC44LDEuNi02LjgsMGMtMi4zLTEuOS01LjYtMi4zLTguMy0xVjIuNWMwLTAuNi0wLjUtMS0xLTEKCXMtMSwwLjQtMSwxdjE4LjhjMCwwLjUsMC41LDEsMSwxaDAuMWMwLjUsMCwxLTAuNSwxLTF2LTYuNGMxLTAuNywyLjEtMS4yLDMuNC0xLjNjMS4yLDAsMi40LDAuNCwzLjQsMS4yYzIuOSwyLjMsNywyLjMsOS44LDAKCWMwLjMtMC4yLDAuNC0wLjUsMC40LTAuOVY0LjdDMjEuNiw0LjIsMjEuMywzLjgsMjAuOCwzLjd6IE0yMC41LDEzLjlDMjAuNSwxMy45LDIwLjUsMTMuOSwyMC41LDEzLjlDMTgsMTYsMTQuNCwxNiwxMS45LDE0CgljLTEuMS0wLjktMi41LTEuNC00LTEuNGMtMS4yLDAuMS0yLjMsMC41LTMuNCwxLjFWNEM3LDIuNiwxMCwyLjksMTIuMiw0LjZjMi40LDEuOSw1LjcsMS45LDguMSwwYzAuMSwwLDAuMSwwLDAuMiwwCgljMCwwLDAuMSwwLjEsMC4xLDAuMUwyMC41LDEzLjl6Ii8+CjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yMC42LDQuOGwtMC4xLDkuMWMwLDAsMCwwLjEsMCwwLjFjLTIuNSwyLTYuMSwyLTguNiwwYy0xLjEtMC45LTIuNS0xLjQtNC0xLjRjLTEuMiwwLjEtMi4zLDAuNS0zLjQsMS4xVjQKCUM3LDIuNiwxMCwyLjksMTIuMiw0LjZjMi40LDEuOSw1LjcsMS45LDguMSwwYzAuMSwwLDAuMSwwLDAuMiwwQzIwLjUsNC43LDIwLjYsNC43LDIwLjYsNC44eiIvPgo8L3N2Zz4K"')).replace(/"[\S]+?repeat\.svg"/gm,'"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIxLjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9InJlcGVhdCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiCgkgdmlld0JveD0iMCAwIDI0IDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiNDRjhCMTc7fQoJLnN0MXtmaWxsOiNGRkZGRkY7fQo8L3N0eWxlPgo8dGl0bGU+cmVwZWF0PC90aXRsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTIzLjMsMTFjLTAuMywwLjYtMC45LDEtMS41LDFoLTEuNmMtMC4xLDEuMy0wLjUsMi41LTEuMSwzLjZjLTAuOSwxLjctMi4zLDMuMi00LjEsNC4xCgljLTEuNywwLjktMy42LDEuMi01LjUsMC45Yy0xLjgtMC4zLTMuNS0xLjEtNC45LTIuM2MtMC43LTAuNy0wLjctMS45LDAtMi42YzAuNi0wLjYsMS42LTAuNywyLjMtMC4ySDdjMC45LDAuNiwxLjksMC45LDIuOSwwLjkKCXMxLjktMC4zLDIuNy0wLjljMS4xLTAuOCwxLjgtMi4xLDEuOC0zLjVoLTEuNWMtMC45LDAtMS43LTAuNy0xLjctMS43YzAtMC40LDAuMi0wLjksMC41LTEuMmw0LjQtNC40YzAuNy0wLjYsMS43LTAuNiwyLjQsMEwyMyw5LjIKCUMyMy41LDkuNywyMy42LDEwLjQsMjMuMywxMXoiLz4KPHBhdGggY2xhc3M9InN0MSIgZD0iTTIxLjgsMTFoLTIuNmMwLDEuNS0wLjMsMi45LTEsNC4yYy0wLjgsMS42LTIuMSwyLjgtMy43LDMuNmMtMS41LDAuOC0zLjMsMS4xLTQuOSwwLjhjLTEuNi0wLjItMy4yLTEtNC40LTIuMQoJYy0wLjQtMC4zLTAuNC0wLjktMC4xLTEuMmMwLjMtMC40LDAuOS0wLjQsMS4yLTAuMWwwLDBjMSwwLjcsMi4yLDEuMSwzLjQsMS4xczIuMy0wLjMsMy4zLTFjMC45LTAuNiwxLjYtMS41LDItMi42CgljMC4zLTAuOSwwLjQtMS44LDAuMi0yLjhoLTIuNGMtMC40LDAtMC43LTAuMy0wLjctMC43YzAtMC4yLDAuMS0wLjMsMC4yLTAuNGw0LjQtNC40YzAuMy0wLjMsMC43LTAuMywwLjksMEwyMiw5LjgKCWMwLjMsMC4zLDAuNCwwLjYsMC4zLDAuOVMyMiwxMSwyMS44LDExeiIvPgo8L3N2Zz4K"')).replace(/"[\S]+?rotate-left\.svg"/gm,'"data:image/svg+xml;base64,PHN2ZyBpZD0icm90YXRlLWNsb2Nrd2lzZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxkZWZzPjxzdHlsZT4uY2xzLTF7ZmlsbDojM2Q3OWNjO30uY2xzLTJ7ZmlsbDojZmZmO308L3N0eWxlPjwvZGVmcz48dGl0bGU+cm90YXRlLWNsb2Nrd2lzZTwvdGl0bGU+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNMjAuMzQsMTguMjFhMTAuMjQsMTAuMjQsMCwwLDEtOC4xLDQuMjIsMi4yNiwyLjI2LDAsMCwxLS4xNi00LjUyaDBhNS41OCw1LjU4LDAsMCwwLDQuMjUtMi41Myw1LjA2LDUuMDYsMCwwLDAsLjU0LTQuNjJBNC4yNSw0LjI1LDAsMCwwLDE1LjU1LDlhNC4zMSw0LjMxLDAsMCwwLTItLjhBNC44Miw0LjgyLDAsMCwwLDEwLjQsOWwxLjEyLDEuNDFBMS41OSwxLjU5LDAsMCwxLDEwLjM2LDEzSDIuNjdhMS41NiwxLjU2LDAsMCwxLTEuMjYtLjYzQTEuNTQsMS41NCwwLDAsMSwxLjEzLDExTDIuODUsMy41N0ExLjU5LDEuNTksMCwwLDEsNC4zOCwyLjQsMS41NywxLjU3LDAsMCwxLDUuNjIsM0w2LjcsNC4zNWExMC42NiwxMC42NiwwLDAsMSw3LjcyLTEuNjhBOS44OCw5Ljg4LDAsMCwxLDE5LDQuODEsOS42MSw5LjYxLDAsMCwxLDIxLjgzLDksMTAuMDgsMTAuMDgsMCwwLDEsMjAuMzQsMTguMjFaIi8+PHBhdGggY2xhc3M9ImNscy0yIiBkPSJNMTkuNTYsMTcuNjVhOS4yOSw5LjI5LDAsMCwxLTcuMzUsMy44MywxLjMxLDEuMzEsMCwwLDEtLjA4LTIuNjIsNi41Myw2LjUzLDAsMCwwLDUtMi45Miw2LjA1LDYuMDUsMCwwLDAsLjY3LTUuNTEsNS4zMiw1LjMyLDAsMCwwLTEuNjQtMi4xNiw1LjIxLDUuMjEsMCwwLDAtMi40OC0xQTUuODYsNS44NiwwLDAsMCw5LDguODRMMTAuNzQsMTFhLjU5LjU5LDAsMCwxLS40MywxSDIuN2EuNi42LDAsMCwxLS42LS43NUwzLjgxLDMuODNhLjU5LjU5LDAsMCwxLDEtLjIxbDEuNjcsMi4xYTkuNzEsOS43MSwwLDAsMSw3Ljc1LTIuMDcsOC44NCw4Ljg0LDAsMCwxLDQuMTIsMS45Miw4LjY4LDguNjgsMCwwLDEsMi41NCwzLjcyQTkuMTQsOS4xNCwwLDAsMSwxOS41NiwxNy42NVoiLz48L3N2Zz4="')).replace(/"[\S]+?rotate-right\.svg"/gm,'"data:image/svg+xml;base64,PHN2ZyBpZD0icm90YXRlLWNvdW50ZXItY2xvY2t3aXNlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOiMzZDc5Y2M7fS5jbHMtMntmaWxsOiNmZmY7fTwvc3R5bGU+PC9kZWZzPjx0aXRsZT5yb3RhdGUtY291bnRlci1jbG9ja3dpc2U8L3RpdGxlPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTIyLjY4LDEyLjJhMS42LDEuNiwwLDAsMS0xLjI3LjYzSDEzLjcyYTEuNTksMS41OSwwLDAsMS0xLjE2LTIuNThsMS4xMi0xLjQxYTQuODIsNC44MiwwLDAsMC0zLjE0LS43Nyw0LjMxLDQuMzEsMCwwLDAtMiwuOCw0LjI1LDQuMjUsMCwwLDAtMS4zNCwxLjczLDUuMDYsNS4wNiwwLDAsMCwuNTQsNC42MkE1LjU4LDUuNTgsMCwwLDAsMTIsMTcuNzRoMGEyLjI2LDIuMjYsMCwwLDEtLjE2LDQuNTJBMTAuMjUsMTAuMjUsMCwwLDEsMy43NCwxOCwxMC4xNCwxMC4xNCwwLDAsMSwyLjI1LDguNzgsOS43LDkuNywwLDAsMSw1LjA4LDQuNjQsOS45Miw5LjkyLDAsMCwxLDkuNjYsMi41YTEwLjY2LDEwLjY2LDAsMCwxLDcuNzIsMS42OGwxLjA4LTEuMzVhMS41NywxLjU3LDAsMCwxLDEuMjQtLjYsMS42LDEuNiwwLDAsMSwxLjU0LDEuMjFsMS43LDcuMzdBMS41NywxLjU3LDAsMCwxLDIyLjY4LDEyLjJaIi8+PHBhdGggY2xhc3M9ImNscy0yIiBkPSJNMjEuMzgsMTEuODNIMTMuNzdhLjU5LjU5LDAsMCwxLS40My0xbDEuNzUtMi4xOWE1LjksNS45LDAsMCwwLTQuNy0xLjU4LDUuMDcsNS4wNywwLDAsMC00LjExLDMuMTdBNiw2LDAsMCwwLDcsMTUuNzdhNi41MSw2LjUxLDAsMCwwLDUsMi45MiwxLjMxLDEuMzEsMCwwLDEtLjA4LDIuNjIsOS4zLDkuMywwLDAsMS03LjM1LTMuODJBOS4xNiw5LjE2LDAsMCwxLDMuMTcsOS4xMiw4LjUxLDguNTEsMCwwLDEsNS43MSw1LjQsOC43Niw4Ljc2LDAsMCwxLDkuODIsMy40OGE5LjcxLDkuNzEsMCwwLDEsNy43NSwyLjA3bDEuNjctMi4xYS41OS41OSwwLDAsMSwxLC4yMUwyMiwxMS4wOEEuNTkuNTksMCwwLDEsMjEuMzgsMTEuODNaIi8+PC9zdmc+"');let f=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(g)}`;document.body.removeChild(s),console.log("%c ",`font-size: 1px; padding-right: ${p}px; padding-bottom: ${d}px; background-image: url('${f}'); background-repeat: no-repeat; background-size: contain; color: transparent;`)}}}function vt(o,s,n,i,l,a){if(o){s.runtime.getEditingTarget()?.id!==a&&s.runtime.getTargetById(a)&&s.setEditingTarget(a),o.getMainWorkspace().centerOnBlock(l,!0);let r="",e=st(o,l,[pt([at(n("lpp.tooltip.button.help.more"),n("lpp.tooltip.button.help.less"),()=>{if(e){let p=e.getElementsByClassName("lpp-hint")[0];p&&(r=p.textContent??"",p.textContent=`\u{1F4A1} ${n(`lpp.error.${i}.detail`)}`)}},()=>{if(e){let p=e.getElementsByClassName("lpp-hint")[0];p&&(p.textContent=r)}}),lt(o,n("lpp.tooltip.button.close"))]),ct(`\u2139\uFE0F ${n(`lpp.error.${i}.summary`)}`),document.createElement("br"),ut(`\u{1F50D} ${n("lpp.error.hint")}`,"lpp-hint")],"left");e||ot({title:`\u274C ${n(`lpp.error.${i}.summary`)}`,body:`\u{1F4CC} ${n("lpp.error.position")} ${l}
\u{1F50D} ${n("lpp.error.hint")}`,tag:"lppError",silent:!1})}else ot({title:`\u274C ${n("lpp.error.releaseMode.summary")}`,body:`\u2139\uFE0F ${n("lpp.error.releaseMode.detail")}
\u{1F50D} ${n("lpp.error.hint")}`,tag:"lppError",silent:!0});if(console.groupCollapsed(`\u274C ${n(`lpp.error.${i}.summary`)}`),o){console.log(`\u{1F4A1} ${n(`lpp.error.${i}.detail`)}`);let r=o.getMainWorkspace()?.getBlockById(l)?.getSvgRoot();console.groupCollapsed(`\u{1F4CC} ${n("lpp.error.position")} ${l}`),r?(Mt(r),console.log(r)):console.log(`\u2753 ${n("lpp.error.blockNotFound")}`),console.groupEnd()}else console.log(`\u2139\uFE0F ${n("lpp.error.releaseMode.detail")}`),console.log(`\u{1F4CC} ${n("lpp.error.position")} ${l}`);console.groupEnd()}function Et(o,s,n,i){if(o){let l=()=>{let t=[];t.push(`\u{1F4A1} ${n("lpp.error.uncaughtException.detail")}`,document.createElement("br"),document.createElement("br")),t.push(`\u{1F914} ${n("lpp.error.uncaughtException.exception")}`,document.createElement("br"),nt(o,s,n,i.value),document.createElement("br")),t.push(`\u{1F47E} ${n("lpp.error.uncaughtException.traceback")}`);let r=document.createElement("ul");r.classList.add("lpp-list");for(let[e,p]of i.stack.entries()){let d=document.createElement("li"),u=document.createElement("span");if(u.classList.add("lpp-code"),o&&p instanceof z.Block)if(s.runtime.getTargetById(p.target)){let g=o.getMainWorkspace();u.classList.add("lpp-traceback-stack-enabled"),u.title=n("lpp.tooltip.button.scrollToBlockEnabled"),u.addEventListener("click",()=>{let f=o.DropDownDiv.getContentDiv().getElementsByClassName("valueReportBox")[0];s.setEditingTarget(p.target),g.centerOnBlock(p.block,!0),o.DropDownDiv.hideWithoutAnimation(),o.DropDownDiv.clearContent(),o.DropDownDiv.getContentDiv().append(f),o.DropDownDiv.showPositionedByBlock(g,g.getBlockById(p.block))})}else u.classList.add("lpp-traceback-stack-disabled"),u.title=n("lpp.tooltip.button.scrollToBlockDisabled");else p instanceof z.NativeFn&&(u.title=n("lpp.tooltip.button.nativeFn"));u.textContent=p.toString(),d.append(`\u{1F4CC} ${e} \u27A1\uFE0F `,u),r.append(d)}return t.push(r),t},a=!1;for(let t of i.stack.toReversed())if(t instanceof z.Block&&s.runtime.getTargetById(t.target)){s.setEditingTarget(t.target),o.getMainWorkspace().centerOnBlock(t.block,!0);let e="",p=st(o,t.block,[pt([at(n("lpp.tooltip.button.help.more"),n("lpp.tooltip.button.help.less"),()=>{if(p){let d=p.getElementsByClassName("lpp-hint")[0];if(d){for(e=d.textContent??"";d.firstChild;)d.removeChild(d.firstChild);d.append(...l())}}},()=>{if(p){let d=p.getElementsByClassName("lpp-hint")[0];d&&(d.textContent=e)}}),lt(o,n("lpp.tooltip.button.close"))]),ct(`\u2139\uFE0F ${n("lpp.error.uncaughtException.summary")}`),document.createElement("br"),ut(`\u{1F50D} ${n("lpp.error.hint")}`,"lpp-hint")],"left");a=!!p;break}a||ot({title:`\u274C ${n("lpp.error.uncaughtException.summary")}`,body:`\u{1F4A1} ${n("lpp.error.uncaughtException.detail")}
\u{1F50D} ${n("lpp.error.hint")}`,tag:"lppError",silent:!1})}else ot({title:`\u274C ${n("lpp.error.releaseMode.summary")}`,body:`\u2139\uFE0F ${n("lpp.error.releaseMode.detail")}
\u{1F50D} ${n("lpp.error.hint")}`,tag:"lppError",silent:!0});console.groupCollapsed(`\u274C ${n("lpp.error.uncaughtException.summary")}`),console.log(o?`\u{1F4A1} ${n("lpp.error.uncaughtException.detail")}`:`\u2139\uFE0F ${n("lpp.error.releaseMode.detail")}`),console.log(`\u{1F914} ${n("lpp.error.uncaughtException.exception")}`,i.value),console.groupCollapsed(`\u{1F47E} ${n("lpp.error.uncaughtException.traceback")}`);for(let[l,a]of i.stack.entries())if(o)if(a instanceof z.Block){let r=o.getMainWorkspace()?.getBlockById(a.block)?.getSvgRoot();console.groupCollapsed(`\u{1F4CC} ${l+1} \u27A1\uFE0F`,a.block),r?(Mt(r),console.log(r)):console.log(`\u2753 ${n("lpp.error.blockNotFound")}`),a.context&&console.log(`\u{1F6E0}\uFE0F ${n("lpp.error.context")}`,a.context),console.groupEnd()}else a instanceof z.NativeFn?(console.groupCollapsed(`\u{1F4CC} ${l+1} \u27A1\uFE0F`,a.fn),console.log(`\u{1F6E0}\uFE0F ${n("lpp.error.self")}`,a.self),console.log(`\u{1F6E0}\uFE0F ${n("lpp.error.arguments")}`,a.args),console.groupEnd()):console.log(`\u{1F4CC} ${l+1} \u27A1\uFE0F`,a.toString());else console.log(`\u{1F4CC} ${l+1} \u27A1\uFE0F`,a.toString());console.groupEnd(),console.groupEnd()}tt.textContent+=`
.lpp-list {
  list-style-type: disc;
  padding: 0;
  margin-left: 19.5px;
  margin-top: 5px;
  margin-bottom: 0;
}
.lpp-list li {
  margin-bottom: 5px;
}
.lpp-code {
  font-family: "Source Code Pro", "Fira Code", "DejaVu Sans Mono", "Cascadia Code", "Jetbrains Mono", "Lucida Console", Consolas, monospace;
}
.lpp-traceback-stack-enabled {
  transition: color 0.25s ease-out;
}
.lpp-traceback-stack-disabled {
  transition: color 0.25s ease-out;
}
.lpp-traceback-stack-enabled:hover {
  cursor: pointer;
  color: gray;
  user-select: text;
}
.lpp-traceback-stack-disabled:hover {
  cursor: not-allowed;
  color: red;
  user-select: text;
}
`;function kt(o,s,n,i,l){let a=c=>({get:()=>({init:c}),set:()=>{}}),t=c=>({get:()=>c,set:()=>{}});function r(c){return c.mutationToDom?o.Xml.domToText(c.mutationToDom()):""}class e extends o.Mutator{drawIcon_(m){o.utils.createSvgElement("path",{class:"blocklyIconSymbol",height:"15",width:"15",opacity:"1",d:"M18 10h-4v-4c0-1.104-.896-2-2-2s-2 .896-2 2l.071 4h-4.071c-1.104 0-2 .896-2 2s.896 2 2 2l4.071-.071-.071 4.071c0 1.104.896 2 2 2s2-.896 2-2v-4.071l4 .071c1.104 0 2-.896 2-2s-.896-2-2-2z",transform:"scale(0.67) translate(0,8.45)"},m)}iconClick_(m){if(!(this.block_.workspace.isDragging()||o.utils.isRightButton(m))){let L=this.block_;n.mutatorClick=!0,o.Events.setGroup(!0);let D=r(L);L.plus&&L.plus();let S=r(L);D!=S&&o.Events.fire(new o.Events.BlockChange(L,"mutation",null,D,S)),o.Events.setGroup(!1)}}constructor(){super(null)}}class p extends o.Mutator{drawIcon_(m){o.utils.createSvgElement("path",{class:"blocklyIconSymbol",height:"15",width:"15",opacity:"1",d:"M18 11h-12c-1.104 0-2 .896-2 2s.896 2 2 2h12c1.104 0 2-.896 2-2s-.896-2-2-2z",transform:"scale(0.67) translate(0,8.45)"},m)}iconClick_(m){if(!(this.block_.workspace.isDragging()||o.utils.isRightButton(m))){let L=this.block_;n.mutatorClick=!0,o.Events.setGroup(!0);let D=r(L);L.minus&&L.minus();let S=r(L);D!=S&&o.Events.fire(new o.Events.BlockChange(L,"mutation",null,D,S)),o.Events.setGroup(!1)}}constructor(){super(null)}}o.MutatorPlus=e,o.MutatorMinus=p,o.BlockSvg.prototype.setMutatorPlus=function(c){this.mutatorPlus&&this.mutatorPlus!==c&&this.mutatorPlus.dispose(),(this.mutatorPlus=c)&&(this.mutatorPlus.block_=this,this.rendered&&this.mutatorPlus.createIcon())},o.BlockSvg.prototype.setMutatorMinus=function(c){this.mutatorMinus&&this.mutatorMinus!==c&&this.mutatorMinus.dispose(),(this.mutatorMinus=c)&&(this.mutatorMinus.block_=this,this.rendered&&this.mutatorMinus.createIcon())};let d=o.InsertionMarkerManager.prototype.update;o.InsertionMarkerManager.prototype.update=function(c,m){let L=this.firstMarker_;if(L.mutatorPlus||L.mutatorMinus)try{return d.call(this,c,m)}catch{o.Events.enable();return}return d.call(this,c,m)};let u=o.BlockSvg.prototype.getIcons;o.BlockSvg.prototype.getIcons=function(){let c=u.call(this),m=this;return m.mutatorPlus&&c.push(m.mutatorPlus),m.mutatorMinus&&c.push(m.mutatorMinus),c};function g(){let c=i.editingTarget;if(!c)return;let m=c.blocks.getBlock(this.id);if(!m)return;let L=new Set(this.inputList.map(S=>S?.name)),D=m.inputs;for(let S of Object.keys(D)){let V=D[S];if(!L.has(S)){let R=c.blocks;R.deleteBlock(V.block),R.deleteBlock(V.shadow),delete D[S]}}}function f(c,m){let L=document.createElement("shadow"),D=document.createElement("field");return L.setAttribute("type","text"),D.setAttribute("name","TEXT"),D.textContent=m??"",L.appendChild(D),c.connection.setShadowDom(L),c.connection.respawnShadow_(),c}function h(c){return c.connection.setShadowDom(null),c.connection.respawnShadow_(),c}Object.defineProperties(o.Blocks,{lpp_builtinType:a(function(){this.jsonInit({type:"lpp_builtinType",inputsInline:!0,category:"lpp",colour:s,output:"String",outputShape:o.OUTPUT_SHAPE_SQUARE,args0:[{type:"field_dropdown",name:"value",options:[["Boolean","Boolean"],["Number","Number"],["String","String"],["Array","Array"],["Object","Object"],["Function","Function"],["Promise","Promise"],["Generator","Generator"],["AsyncGenerator","AsyncGenerator"]]}],message0:"%1",tooltip:l("lpp.tooltip.builtin.type")})}),lpp_builtinError:a(function(){this.jsonInit({type:"lpp_builtinError",inputsInline:!0,category:"lpp",colour:s,output:"String",outputShape:o.OUTPUT_SHAPE_SQUARE,args0:[{type:"field_dropdown",name:"value",options:[["Error","Error"],["IllegalInvocationError","IllegalInvocationError"],["SyntaxError","SyntaxError"]]}],message0:"%1",tooltip:l("lpp.tooltip.builtin.error")})}),lpp_builtinUtility:a(function(){this.jsonInit({type:"lpp_builtinError",inputsInline:!0,category:"lpp",colour:s,output:"String",outputShape:o.OUTPUT_SHAPE_SQUARE,args0:[{type:"field_dropdown",name:"value",options:[["JSON","JSON"],["Math","Math"]]}],message0:"%1",tooltip:l("lpp.tooltip.builtin.utility")})}),lpp_constructLiteral:a(function(){this.jsonInit({type:"lpp_constructLiteral",inputsInline:!0,category:"lpp",colour:s,output:"String",outputShape:o.OUTPUT_SHAPE_SQUARE,args0:[{type:"field_dropdown",name:"value",options:[["null","null"],["true","true"],["false","false"],["NaN","NaN"],["Infinity","Infinity"]]}],message0:"%1",tooltip:l("lpp.tooltip.construct.literal")})}),lpp_constructNumber:a(function(){this.setCategory("lpp"),this.setColour(s),this.setOutput(!0,"String"),this.setInputsInline(!0),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.appendDummyInput().appendField(l("lpp.block.construct.Number")).appendField("("),this.appendValueInput("value"),this.appendDummyInput().appendField(")"),this.setTooltip(l("lpp.tooltip.construct.Number"))}),lpp_constructString:a(function(){this.setCategory("lpp"),this.setColour(s),this.setOutput(!0,"String"),this.setInputsInline(!0),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.appendDummyInput().appendField(l("lpp.block.construct.String")).appendField("("),this.appendValueInput("value"),this.appendDummyInput().appendField(")"),this.setTooltip(l("lpp.tooltip.construct.String"))}),lpp_constructArray:t({init:function(){this.setCategory("lpp"),this.setMutatorPlus(new e),this.setColour(s),this.setOutput(!0,"String"),this.setInputsInline(!0),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.appendDummyInput().appendField("["),this.appendDummyInput("ENDBRACE").appendField("]"),this.setTooltip(l("lpp.tooltip.construct.Array")),this.length=0},mutationToDom:function(){let c=document.createElement("mutation");return c.setAttribute("length",String(this.length)),c},domToMutation:function(c){let m=parseInt(c.getAttribute("length")??"0",10);if(m>0){this.setMutatorMinus(new p);for(let L=0;L<m;L++){let D=this.appendValueInput(`ARG_${L}`);this.isInsertionMarker()||h(D),this.moveInputBefore(`ARG_${L}`,"ENDBRACE"),L<m-1&&(this.appendDummyInput(`COMMA_${L}`).appendField(","),this.moveInputBefore(`COMMA_${L}`,"ENDBRACE"))}}this.length=m},plus:function(){let c=this.length++;this.mutatorMinus??this.setMutatorMinus(new p),c!=0&&(this.appendDummyInput(`COMMA_${c}`).appendField(","),this.moveInputBefore(`COMMA_${c}`,"ENDBRACE")),h(this.appendValueInput(`ARG_${c}`)),this.moveInputBefore(`ARG_${c}`,"ENDBRACE"),this.initSvg(),this.render()},minus:function(){this.length>0&&(this.length--,this.length!=0?this.removeInput(`COMMA_${this.length}`):this.setMutatorMinus(),this.removeInput(`ARG_${this.length}`),g.call(this),this.initSvg(),this.render())}}),lpp_constructObject:t({init:function(){this.setCategory("lpp"),this.setMutatorPlus(new e),this.setColour(s),this.setOutput(!0,"String"),this.setInputsInline(!0),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.appendDummyInput().appendField("{"),this.length=0,this.appendDummyInput("ENDBRACE").appendField("}"),this.setTooltip(l("lpp.tooltip.construct.Object"))},mutationToDom:function(){let c=document.createElement("mutation");return c.setAttribute("length",String(this.length)),c},domToMutation:function(c){let m=parseInt(c.getAttribute("length")??"0",10);if(m>0){this.setMutatorMinus(new p);for(let L=0;L<m;L++){let D=this.appendValueInput(`KEY_${L}`),S=this.appendValueInput(`VALUE_${L}`);this.appendDummyInput(`COLON_${L}`).appendField(":"),this.isInsertionMarker()||(f(D),h(S)),this.moveInputBefore(`VALUE_${L}`,"ENDBRACE"),this.moveInputBefore(`COLON_${L}`,`VALUE_${L}`),this.moveInputBefore(`KEY_${L}`,`COLON_${L}`),L<m-1&&(this.appendDummyInput(`COMMA_${L}`).appendField(","),this.moveInputBefore(`COMMA_${L}`,"ENDBRACE"))}}this.length=m},plus:function(){let c=this.length++;this.mutatorMinus??this.setMutatorMinus(new p),c!=0&&(this.appendDummyInput(`COMMA_${c}`).appendField(","),this.moveInputBefore(`COMMA_${c}`,"ENDBRACE")),this.appendDummyInput(`COLON_${c}`).appendField(":"),f(this.appendValueInput(`KEY_${c}`)),h(this.appendValueInput(`VALUE_${c}`)),this.moveInputBefore(`VALUE_${c}`,"ENDBRACE"),this.moveInputBefore(`COLON_${c}`,`VALUE_${c}`),this.moveInputBefore(`KEY_${c}`,`COLON_${c}`),this.initSvg(),this.render()},minus:function(){this.length>0&&(this.length--,this.length!=0?this.removeInput(`COMMA_${this.length}`):this.setMutatorMinus(),this.removeInput(`KEY_${this.length}`),this.removeInput(`COLON_${this.length}`),this.removeInput(`VALUE_${this.length}`),g.call(this),this.initSvg(),this.render())}}),lpp_constructFunction:t({init:function(){this.setCategory("lpp"),this.setMutatorPlus(new e),this.setColour(s),this.setOutput(!0,"String"),this.setInputsInline(!0),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.appendDummyInput().appendField(l("lpp.block.construct.Function")).appendField("("),this.appendDummyInput("ENDBRACE").appendField(")"),this.appendStatementInput("SUBSTACK"),this.setTooltip(l("lpp.tooltip.construct.Function")),this.length=0},mutationToDom:function(){let c=document.createElement("mutation");return c.setAttribute("length",String(this.length)),c},domToMutation:function(c){let m=parseInt(c.getAttribute("length")??"0",10);if(m>0){this.setMutatorMinus(new p);for(let L=0;L<m;L++){let D=this.appendValueInput(`ARG_${L}`);this.isInsertionMarker()||f(D),this.moveInputBefore(`ARG_${L}`,"ENDBRACE"),L<m-1&&(this.appendDummyInput(`COMMA_${L}`).appendField(","),this.moveInputBefore(`COMMA_${L}`,"ENDBRACE"))}}this.length=m},plus:function(){let c=this.length++;this.mutatorMinus??this.setMutatorMinus(new p),c!=0&&(this.appendDummyInput(`COMMA_${c}`).appendField(","),this.moveInputBefore(`COMMA_${c}`,"ENDBRACE")),f(this.appendValueInput(`ARG_${c}`)),this.moveInputBefore(`ARG_${c}`,"ENDBRACE"),this.initSvg(),this.render()},minus:function(){this.length>0&&(this.length--,this.length!=0?this.removeInput(`COMMA_${this.length}`):this.setMutatorMinus(),this.removeInput(`ARG_${this.length}`),g.call(this),this.initSvg(),this.render())}}),lpp_var:a(function(){this.setCategory("lpp"),this.setInputsInline(!0),this.setColour(s),this.setOutput(!0,"String"),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.setTooltip(l("lpp.tooltip.operator.var")),this.appendDummyInput().appendField(l("lpp.block.operator.var")),this.appendValueInput("name")}),lpp_binaryOp:a(function(){this.setCategory("lpp"),this.setInputsInline(!0),this.setColour(s),this.setOutput(!0,"String"),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.setTooltip(l("lpp.tooltip.operator.binaryOp")),this.appendValueInput("lhs"),this.appendDummyInput().appendField(new o.FieldDropdown([["=","="],[".","."],["+","+"],["-","-"],["*","*"],["/","/"],["%","%"],["==","=="],["!=","!="],[">",">"],["<","<"],[">=",">="],["<=","<="],["&&","&&"],["||","||"],["<<","<<"],[">>",">>"],[">>>",">>>"],["&","&"],["|","|"],["^","^"],["instanceof","instanceof"],["in","in"]]),"op"),this.appendValueInput("rhs")}),lpp_unaryOp:a(function(){this.jsonInit({type:"lpp_unaryOp",inputsInline:!0,category:"lpp",colour:s,output:"String",outputShape:o.OUTPUT_SHAPE_SQUARE,args0:[{type:"field_dropdown",name:"op",options:[["+","+"],["-","-"],["!","!"],["~","~"],["delete","delete"],["await","await"],["yield","yield"],["yield*","yield*"]]},{type:"input_value",name:"value"}],message0:"%1%2",tooltip:l("lpp.tooltip.operator.unaryOp")})}),lpp_self:a(function(){this.jsonInit({type:"lpp_self",inputsInline:!0,checkboxInFlyout:!1,category:"lpp",colour:s,output:"String",outputShape:o.OUTPUT_SHAPE_SQUARE,message0:l("lpp.block.operator.self"),tooltip:l("lpp.tooltip.operator.self")})}),lpp_call:t({init:function(){this.setCategory("lpp"),this.setMutatorPlus(new e),this.setColour(s),this.setOutput(!0,"String"),this.setInputsInline(!0),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.appendValueInput("fn"),this.appendDummyInput().appendField("("),this.length=0,this.appendDummyInput("ENDBRACE").appendField(")"),this.setTooltip(l("lpp.tooltip.operator.call"))},mutationToDom:function(){let c=document.createElement("mutation");return c.setAttribute("length",String(this.length)),c},domToMutation:function(c){let m=parseInt(c.getAttribute("length")??"0",10);if(m>0){this.setMutatorMinus(new p);for(let L=0;L<m;L++)this.isInsertionMarker()||h(this.appendValueInput(`ARG_${L}`)),this.moveInputBefore(`ARG_${L}`,"ENDBRACE"),L<m-1&&(this.appendDummyInput(`COMMA_${L}`).appendField(","),this.moveInputBefore(`COMMA_${L}`,"ENDBRACE"))}this.length=m},plus:function(){let c=this.length++;this.mutatorMinus??this.setMutatorMinus(new p),c!=0&&(this.appendDummyInput(`COMMA_${c}`).appendField(","),this.moveInputBefore(`COMMA_${c}`,"ENDBRACE")),h(this.appendValueInput(`ARG_${c}`)),this.moveInputBefore(`ARG_${c}`,"ENDBRACE"),this.initSvg(),this.render()},minus:function(){this.length>0&&(this.length--,this.length!=0?this.removeInput(`COMMA_${this.length}`):this.setMutatorMinus(),this.removeInput(`ARG_${this.length}`),g.call(this),this.initSvg(),this.render())}}),lpp_new:t({init:function(){this.setCategory("lpp"),this.setMutatorPlus(new e),this.setColour(s),this.setOutput(!0,"String"),this.setInputsInline(!0),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.appendDummyInput().appendField("new "),this.appendValueInput("fn"),this.appendDummyInput().appendField("("),this.length=0,this.appendDummyInput("ENDBRACE").appendField(")"),this.setTooltip(l("lpp.tooltip.operator.new"))},mutationToDom:function(){let c=document.createElement("mutation");return c.setAttribute("length",String(this.length)),c},domToMutation:function(c){let m=parseInt(c.getAttribute("length")??"0",10);if(m>0){this.setMutatorMinus(new p);for(let L=0;L<m;L++)this.isInsertionMarker()||h(this.appendValueInput(`ARG_${L}`)),this.moveInputBefore(`ARG_${L}`,"ENDBRACE"),L<m-1&&(this.appendDummyInput(`COMMA_${L}`).appendField(","),this.moveInputBefore(`COMMA_${L}`,"ENDBRACE"))}this.length=m},plus:function(){let c=this.length++;this.mutatorMinus??this.setMutatorMinus(new p),c!=0&&(this.appendDummyInput(`COMMA_${c}`).appendField(","),this.moveInputBefore(`COMMA_${c}`,"ENDBRACE")),h(this.appendValueInput(`ARG_${c}`)),this.moveInputBefore(`ARG_${c}`,"ENDBRACE"),this.initSvg(),this.render()},minus:function(){this.length>0&&(this.length--,this.length!=0?this.removeInput(`COMMA_${this.length}`):this.setMutatorMinus(),this.removeInput(`ARG_${this.length}`),g.call(this),this.initSvg(),this.render())}}),lpp_return:a(function(){this.setCategory("lpp"),this.setInputsInline(!0),this.setColour(s),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.setTooltip(l("lpp.tooltip.statement.return")),this.setPreviousStatement(!0,null),this.appendDummyInput().appendField(l("lpp.block.statement.return")),this.appendValueInput("value")}),lpp_throw:a(function(){this.setCategory("lpp"),this.setInputsInline(!0),this.setColour(s),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.setTooltip(l("lpp.tooltip.statement.throw")),this.setPreviousStatement(!0,null),this.appendDummyInput().appendField(l("lpp.block.statement.throw")),this.appendValueInput("value")}),lpp_scope:a(function(){this.setCategory("lpp"),this.setColour(s),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.appendDummyInput().appendField(l("lpp.block.statement.scope")),this.appendStatementInput("SUBSTACK"),this.setTooltip(l("lpp.tooltip.statement.scope"))}),lpp_try:a(function(){this.setCategory("lpp"),this.setColour(s),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.appendDummyInput().appendField(l("lpp.block.statement.try.1")),this.appendStatementInput("SUBSTACK"),this.appendDummyInput().appendField(l("lpp.block.statement.try.2")),this.appendValueInput("var"),this.appendStatementInput("SUBSTACK_2"),this.setTooltip(l("lpp.tooltip.statement.try"))}),lpp_nop:a(function(){this.setCategory("lpp"),this.setInputsInline(!0),this.setColour(s),this.setInputsInline(!0),this.setOutputShape(o.OUTPUT_SHAPE_SQUARE),this.setTooltip(l("lpp.tooltip.statement.nop")),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.appendValueInput("value")})})}var I=class o extends String{constructor(n){super(n.toString());this.value=n}static unwrap(n){return n instanceof o?n.value:n}toString(){return this.value.toString()}};function xt(){function o(s,n){let i=v(s);i instanceof b&&dt(i,n)}o(T.Function.get("prototype").get("apply"),["self","args"]),o(T.Function.get("deserialize"),["obj"]),o(T.Function.get("serialize"),["fn"]),o(T.Promise,["executor"]),o(T.Promise.get("prototype").get("then"),["onFulfilled","onRejected?"]),o(T.Promise.get("prototype").get("catch"),["onRejected"]),o(T.JSON.get("parse"),["json"]),o(T.JSON.get("stringify"),["value"])}(function(o){let s="#808080",n="Development (for Turbowarp / Cocrea users)";if(o.extensions.unsandboxed===!1)throw new Error("lpp must be loaded in unsandboxed mode.");function i(a){let t=Function.prototype.apply;Function.prototype.apply=function(e){return e};let r=a();return Function.prototype.apply=t,r}class l{runtime;vm;Blockly;initalized;mutatorClick;util;constructor(t){this.initalized=!1,this.runtime=t,this.Blockly=void 0,this.mutatorClick=!1,o.translate.setup(bt);let r;if(this.runtime._events.QUESTION instanceof Array)for(let p of this.runtime._events.QUESTION){let d=i(p);if(d?.props?.vm){r=d?.props?.vm;break}}else this.runtime._events.QUESTION&&(r=i(this.runtime._events.QUESTION)?.props?.vm);if(!r)throw new Error("lpp cannot get Virtual Machine instance.");if(this.vm=r,this.vm._events.EXTENSION_ADDED instanceof Array)for(let p of this.vm._events.EXTENSION_ADDED){let d=i(p);if(d?.ScratchBlocks){this.Blockly=d?.ScratchBlocks;break}}else this.vm._events.EXTENSION_ADDED&&(this.Blockly=i(this.vm._events.EXTENSION_ADDED)?.ScratchBlocks);let e=this.runtime.emit;this.runtime.emit=(p,...d)=>(["SAY","QUESTION"].includes(p)&&d.length>=1&&d[0]instanceof Object&&Reflect.get(d[0],"id")===""&&(this.handleError(new M("useAfterDispose")),this.runtime.stopAll()),e.call(this.runtime,p,...d)),T.Function.set("serialize",b.native((p,d)=>{let u=d[0];if(p!==T.Function||!u||!(u instanceof b)||!J(u)||u.isTypehint){let g=T.IllegalInvocationError.construct([]);if(g instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return g instanceof y?g:new y(g.value)}return new x(l.serializeFunction(u.blocks&&u.block?u.blocks.getBlock(u.block):void 0,u.blocks,u.signature))})),T.Function.set("deserialize",b.native((p,d)=>{if(p!==T.Function){let f=T.IllegalInvocationError.construct([]);if(f instanceof globalThis.Promise)throw new globalThis.Error("lpp: IllegalInvocationError constructor should be synchronous");return f instanceof y?f:new y(f.value)}let u=Y(d[0]??new w(null));if(ht.isInfo(u)){if(!u.block){let m=new b(()=>new x(new w(null)));return et(m,void 0,void 0,void 0,u.signature),new x(m)}let f=this.runtime.flyoutBlocks.constructor,h=new f(this.runtime,!0);wt(h,u.script);let c=new b((m,L)=>{let D=this.runtime.targets[0].constructor,S,V,R=this.createDummyTarget(D,h),U=h.getBlock(u.block??"");if(!U?.inputs?.SUBSTACK)return new x(new w(null));let O=this.runtime._pushThread(U.inputs.SUBSTACK.block,R);O.lpp=new Z(void 0,m??new w(null),P=>{V||(S?S(P):V=P)},P=>{V||(S?S(P):V=P)});for(let[P,$]of u.signature.entries())P<L.length?O.lpp.closure.set($,L[P]):O.lpp.closure.set($,new w(null));return this.bindThread(O,()=>{O?.lpp?.returnCallback(new x(new w(null)))}),this.stepThread(O),V??new Promise(P=>{S=P})});return et(c,void 0,h,u.block,u.signature),new x(c)}let g=T.SyntaxError.construct([new w("Invalid value")]);if(g instanceof globalThis.Promise)throw new globalThis.Error("lpp: SyntaxError constructor should be synchronous");return g instanceof y?g:new y(g.value)})),xt(),this.runtime.lpp={LppValue:N,LppReference:E,LppConstant:w,LppArray:j,LppObject:k,LppFunction:b,LppReturn:x,LppException:y,LppPromise:_,Wrapper:I,Serialization:gt,version:n,global:C},console.groupCollapsed("\u{1F4AB} lpp",n),console.log("\u{1F31F}",this.formatMessage("lpp.about.summary")),console.log("\u{1F916}",this.formatMessage("lpp.about.github"),"-> https://github.com/FurryR/lpp-scratch"),console.log("\u{1F49E}",this.formatMessage("lpp.about.afdian"),"-> https://afdian.net/a/FurryR"),console.group("\u{1F47E}",this.formatMessage("lpp.about.staff.1")),console.log("\u{1F43A} @FurryR https://github.com/FurryR - Developer, Test, Translation, Documentation"),console.log("\u{1F914} @SimonShiki https://github.com/SimonShiki - Test, Technical support"),console.log("\u{1F604} @Nights https://github.com/Nightre - Technical support"),console.log("\u{1F524} @CST1229 https://github.com/CST1229 - Technical support"),console.log("\u{1F43A} @VeroFess https://github.com/VeroFess - Technical support"),console.log("\u{1F970}",this.formatMessage("lpp.about.staff.2")),console.groupEnd(),console.groupEnd()}formatMessage(t){return o.translate({id:t,default:t,description:t})}getInfo(){return this.initalized||(this.initalized=!0,this.Blockly&&kt(this.Blockly,s,this,this.vm,this.formatMessage.bind(this))),{id:"lpp",name:this.formatMessage("lpp.name"),color1:s,blocks:[{blockType:"label",text:`#\uFE0F\u20E3 ${this.formatMessage("lpp.category.builtin")}`},{opcode:"builtinType",blockType:"reporter",text:"[value]",arguments:{value:{type:"string",menu:"dummy"}}},{opcode:"builtinError",blockType:"reporter",text:"[value]",arguments:{value:{type:"string",menu:"dummy"}}},{opcode:"builtinUtility",blockType:"reporter",text:"[value]",arguments:{value:{type:"string",menu:"dummy"}}},{blockType:"label",text:`\u{1F6A7} ${this.formatMessage("lpp.category.construct")}`},{opcode:"constructLiteral",blockType:"reporter",text:"[value]",arguments:{value:{type:"string",menu:"dummy"}}},{opcode:"constructNumber",blockType:"reporter",text:"[value]",arguments:{value:{type:"string",defaultValue:"10"}}},{opcode:"constructString",blockType:"reporter",text:"[value]",arguments:{value:{type:"string",defaultValue:"\u{1F31F}"}}},{opcode:"constructArray",blockType:"reporter",text:""},{opcode:"constructObject",blockType:"reporter",text:""},{opcode:"constructFunction",blockType:"reporter",text:""},{blockType:"label",text:`\u{1F522} ${this.formatMessage("lpp.category.operator")}`},{opcode:"binaryOp",blockType:"reporter",text:"[lhs][op][rhs]",arguments:{lhs:{type:"string"},op:{type:"string",menu:"dummy"},rhs:{type:"string"}}},{opcode:"unaryOp",blockType:"reporter",text:"[op][value]",arguments:{op:{type:"string",menu:"dummy"},value:{type:"any"}}},{opcode:"call",blockType:"reporter",text:"[fn]",arguments:{fn:{type:"any"}}},{opcode:"new",blockType:"reporter",text:"[fn]",arguments:{fn:{type:"any"}}},{opcode:"self",blockType:"reporter",text:""},{opcode:"var",blockType:"reporter",text:"[name]",arguments:{name:{type:"string",defaultValue:"\u{1F43A}"}}},{blockType:"label",text:`\u{1F916} ${this.formatMessage("lpp.category.statement")}`},{opcode:"return",isTerminal:!0,blockType:"command",text:"[value]",arguments:{value:{type:"any"}}},{opcode:"throw",isTerminal:!0,blockType:"command",text:"[value]",arguments:{value:{type:"any"}}},{opcode:"scope",blockType:"command",text:""},{opcode:"try",blockType:"command",text:"[var]",arguments:{var:{type:"any"}}},{opcode:"nop",blockType:"command",text:"[value]",arguments:{value:{type:"any"}}}],menus:{dummy:{acceptReporters:!1,items:[]}}}}builtinType(t,r){let{thread:e}=r,p=C.get(t.value),d=this.getActiveBlockInstance(t,e);if(this.util=r,p)return this.visualReport(d.id,e,p),new I(p);throw new Error("lpp: not implemented")}builtinError(t,r){return this.util=r,this.builtinType(t,r)}builtinUtility(t,r){return this.util=r,this.builtinType(t,r)}constructLiteral(t,r){let{thread:e}=r;if(this.util=r,this.shouldExit(e))try{return e.stopThisScript()}catch{return}let p=this.getActiveBlockInstance(t,e),d=(()=>{switch(t.value){case"null":return new w(null);case"true":return new w(!0);case"false":return new w(!1);case"NaN":return new w(NaN);case"Infinity":return new w(1/0)}throw new Error("lpp: unknown literal")})();return this.visualReport(p.id,e,d),new I(d)}binaryOp(t,r){let{thread:e}=r;this.util=r;try{if(this.shouldExit(e))try{return e.stopThisScript()}catch{return}let p=I.unwrap(t.lhs),d=I.unwrap(t.rhs),u=this.getActiveBlockInstance(t,e),g=(()=>{if(t.op==="."){if(p instanceof N||p instanceof E){if(typeof d=="string"||typeof d=="number")return p.get(`${d}`);if(d instanceof N||d instanceof E){let f=v(d);if(f instanceof w&&f.value!==null)return p.get(f.toString())}throw new M("invalidIndex")}throw new M("syntaxError")}else if((p instanceof N||p instanceof E)&&(d instanceof N||d instanceof E))switch(t.op){case"=":case"+":case"*":case"==":case"!=":case">":case"<":case">=":case"<=":case"&&":case"||":case"-":case"/":case"%":case"<<":case">>":case">>>":case"&":case"|":case"^":case"instanceof":return p.calc(t.op,v(d));case"in":{let f=v(p),h=v(d);if(!(f instanceof w&&f.value!==null))throw new M("invalidIndex");return new w(h.has(f.toString()))}default:throw new Error("lpp: unknown operand")}throw new M("syntaxError")})();return this.visualReport(u.id,e,v(g)),new I(g)}catch(p){this.handleError(p)}}unaryOp(t,r){let{thread:e}=r;this.util=r;try{if(this.shouldExit(e))try{return e.stopThisScript()}catch{return}let p=I.unwrap(t.value),d=this.getActiveBlockInstance(t,e);if(!(p instanceof N||p instanceof E))throw new M("syntaxError");let u=(()=>{switch(t.op){case"+":case"-":case"!":case"~":case"delete":return p.calc(t.op);default:throw new Error("lpp: unknown operand")}})();return this.visualReport(d.id,e,u),new I(u)}catch(p){this.handleError(p)}}call(t,r){try{let{fn:e}=t,{thread:p}=r;this.util=r,e=I.unwrap(e);let d=[];if(this.shouldExit(p))try{return p.stopThisScript()}catch{return}let u=this.getActiveBlockInstance(t,p),g=parseInt(this.getMutation(u)?.length??"0",10);for(let h=0;h<g;h++){let c=I.unwrap(t[`ARG_${h}`]);if(c instanceof N||c instanceof E)d[h]=v(c);else throw new M("syntaxError")}if(!(e instanceof N||e instanceof E))throw new M("syntaxError");let f=v(e);if(f instanceof b){let h=f.apply(e instanceof E?e.parent.deref()??new w(null):new w(null),d);if(h instanceof Promise)return h.then(c=>{let m=this.processApplyValue(c,p);if(m)return this.visualReport(u.id,p,m),new I(m)});{let c=this.processApplyValue(h,p);if(c)return this.visualReport(u.id,p,c),new I(c)}}else throw new M("notCallable")}catch(e){this.handleError(e)}}new(t,r){try{let{fn:e}=t,{thread:p}=r;this.util=r,e=I.unwrap(e);let d=[];if(this.shouldExit(p))try{return p.stopThisScript()}catch{return}let u=this.getActiveBlockInstance(t,p),g=parseInt(this.getMutation(u)?.length??"0",10);for(let h=0;h<g;h++){let c=I.unwrap(t[`ARG_${h}`]);if(c instanceof N||c instanceof E)d[h]=v(c);else throw new M("syntaxError")}if(!(e instanceof N||e instanceof E))throw new M("syntaxError");if(e=v(e),!(e instanceof b))throw new M("notCallable");let f=e.construct(d);if(f instanceof Promise)return f.then(h=>{let c=this.processApplyValue(h,p);if(c)return this.visualReport(u.id,p,c),new I(c)});{let h=this.processApplyValue(f,p);if(h)return this.visualReport(u.id,p,h),new I(h)}}catch(e){this.handleError(e)}}self(t,r){try{let{thread:e}=r;if(this.util=r,this.shouldExit(e))try{return e.stopThisScript()}catch{return}let p=this.getActiveBlockInstance(t,e),d=e;if(d.lpp){let u=d.lpp.unwind();if(u)return this.visualReport(p.id,e,u.self),new I(u.self)}throw new M("useOutsideFunction")}catch(e){this.handleError(e)}}constructNumber(t,r){let{thread:e}=r,p=new w(Number(t.value)),d=this.getActiveBlockInstance(t,e);return this.util=r,this.visualReport(d.id,e,p),new I(p)}constructString(t,r){let{thread:e}=r,p=new w(String(t.value)),d=this.getActiveBlockInstance(t,e);return this.util=r,this.visualReport(d.id,e,p),new I(p)}constructArray(t,r){try{let{thread:e}=r;if(this.util=r,this.shouldExit(e))try{return e.stopThisScript()}catch{return}let p=new j,d=this.getActiveBlockInstance(t,e),u=parseInt(this.getMutation(d)?.length??"0",10);for(let g=0;g<u;g++){let f=I.unwrap(t[`ARG_${g}`]);if(!(f instanceof N||f instanceof E))throw new M("syntaxError");p.value.push(v(f))}return this.visualReport(d.id,e,p),new I(p)}catch(e){this.handleError(e)}}constructObject(t,r){try{let{thread:e}=r;if(this.util=r,this.shouldExit(e))try{return e.stopThisScript()}catch{return}let p=new k,d=this.getActiveBlockInstance(t,e),u=parseInt(this.getMutation(d)?.length??"0",10);for(let g=0;g<u;g++){let f=I.unwrap(t[`KEY_${g}`]),h=I.unwrap(t[`VALUE_${g}`]);if(typeof f=="string"||typeof f=="number")f=`${f}`;else if(f instanceof w)f=f.toString();else if(f instanceof E&&f.value instanceof w)f=f.value.toString();else throw new M("invalidIndex");if(!(h instanceof N||h instanceof E))throw new M("syntaxError");p.set(f,v(h))}return this.visualReport(d.id,e,p),new I(p)}catch(e){this.handleError(e)}}constructFunction(t,r){try{let{thread:e,target:p}=r;this.util=r;let d=p.constructor;if(this.shouldExit(e))try{return e.stopThisScript()}catch{return}let u=this.getActiveBlockInstance(t,e),g=[],f=parseInt(u?.mutation?.length??"0",10);for(let S=0;S<f;S++)if(typeof t[`ARG_${S}`]!="object")g[S]=String(t[`ARG_${S}`]);else throw new M("syntaxError");let h,c=e.target.blocks,m=p.id,L=e;L.lpp&&(h=L.lpp);let D=new b((S,V)=>{let R,U,O=this.runtime.getTargetById(m)??this.createDummyTarget(d,c);if(!u.inputs.SUBSTACK)return new x(new w(null));let P=u.inputs.SUBSTACK.block,$=this.runtime._pushThread(P,O);$.lpp=new Z(h,S??new w(null),F=>{U||(R?R(F):U=F)},F=>{U||(R?R(F):U=F)});for(let[F,mt]of g.entries())F<V.length?$.lpp.closure.set(mt,V[F]):$.lpp.closure.set(mt,new w(null));return this.bindThread($,()=>{$?.lpp?.returnCallback(new x(new w(null)))}),this.stepThread($),U??new Promise(F=>{R=F})});return et(D,p.sprite.clones[0].id,c,u.id,g),this.visualReport(u.id,e,D),new I(D)}catch(e){this.handleError(e)}}var(t,r){try{let{thread:e}=r;if(this.util=r,this.shouldExit(e))try{return e.stopThisScript()}catch{return}let p=this.getActiveBlockInstance(t,e),d=e;if(d.lpp){let u=d.lpp.get(t.name);return this.visualReport(p.id,e,u.value),new I(u)}throw new M("useOutsideContext")}catch(e){this.handleError(e)}}return({value:t},r){try{let{thread:e}=r;if(this.util=r,this.shouldExit(e))try{return e.stopThisScript()}catch{return}if(t=I.unwrap(t),!(t instanceof N||t instanceof E))throw new M("syntaxError");let p=v(t),d=e;if(d.lpp){let u=d.lpp.unwind();if(u instanceof Z)return u.returnCallback(new x(p)),e.stopThisScript()}throw new M("useOutsideFunction")}catch(e){this.handleError(e)}}throw({value:t},r){try{let{thread:e}=r;if(this.util=r,this.shouldExit(e))try{return e.stopThisScript()}catch{return}if(t=I.unwrap(t),!(t instanceof N||t instanceof E))throw new M("syntaxError");let p=v(t),d=new y(p),u=e;if(d.pushStack(new z.Block(e.target.sprite.clones[0].id,e.peekStack(),u.lpp??void 0)),u.lpp)return u.lpp.exceptionCallback(d),e.stopThisScript();this.handleException(d)}catch(e){this.handleError(e)}}scope(t,r){try{let{thread:e,target:p}=r;if(this.util=r,this.shouldExit(e))try{return e.stopThisScript()}catch{return}let u=this.getActiveBlockInstance(t,e).inputs.SUBSTACK?.block;if(!u)return;let g=e,f=this.runtime._pushThread(u,p),h,c=!1;return f.lpp=new W(g.lpp??void 0,m=>{if(g.lpp)return g.lpp.returnCallback(m),f.stopThisScript();throw new M("useOutsideFunction")},m=>{if(g.lpp)return g.lpp.exceptionCallback(m),e.stopThisScript();this.handleException(m)}),this.bindThread(f,()=>{h?h():c=!0}),this.stepThread(f),c?void 0:new Promise(m=>{h=m})}catch(e){this.handleError(e)}}try(t,r){try{let{thread:e,target:p}=r;if(this.util=r,this.shouldExit(e))try{return e.stopThisScript()}catch{return}let d=this.getActiveBlockInstance(t,e),u=I.unwrap(t.var);if(!(u instanceof E))throw new M("syntaxError");let g=d.inputs.SUBSTACK?.block;if(!g)return;let f=d.inputs.SUBSTACK_2?.block,h=e,c=this.runtime._pushThread(g,p),m=!1,L,D=!1;return c.lpp=new W(h.lpp??void 0,S=>{if(h.lpp)return h.lpp.returnCallback(S),c.stopThisScript();throw new M("useOutsideFunction")},S=>{if(m=!0,!f){L?L():D=!0;return}let V=C.get("Error");if(!(V instanceof b))throw new Error("lpp: not implemented");let R=S.value;if(R.instanceof(V)){let O=new j(S.stack.map(P=>new w(P.toString())));R.set("stack",O)}u.assign(R);let U=this.runtime._pushThread(f,p);U.lpp=new W(h.lpp??void 0,O=>{if(h.lpp)return h.lpp.returnCallback(O),e.stopThisScript();throw new M("useOutsideFunction")},O=>{if(h.lpp)return h.lpp.exceptionCallback(O),e.stopThisScript();this.handleException(O)}),this.bindThread(U,()=>{L?L():D=!0}),this.stepThread(U)}),this.bindThread(c,()=>{m||(L?L():D=!0)}),this.stepThread(c),D?void 0:new Promise(S=>{L=S})}catch(e){this.handleError(e)}}nop({value:t},r){let{thread:e}=r;if(this.util=r,this.shouldExit(e))try{return e.stopThisScript()}catch{return}if(this.Blockly&&e.stackClick&&e.atStackTop()&&!e.target.blocks.getBlock(e.peekStack())?.next&&t){let p=I.unwrap(t);p instanceof N||p instanceof E?this.visualReport(e.peekStack(),e,v(p)):this.Blockly.getMainWorkspace().reportValue(e.peekStack(),String(t))}}handleError(t){if(t instanceof M){let r=this.util?.thread;if(r){let e=r.peekStack();e&&(vt(this.Blockly,this.vm,this.formatMessage.bind(this),t.id,e,r.target.sprite.clones[0].id),this.runtime.stopAll())}}else throw t}handleException(t){Et(this.Blockly,this.vm,this.formatMessage.bind(this),t),this.runtime.stopAll()}bindThread(t,r){let e=t.status,p=!1,d=t.constructor;Reflect.defineProperty(t,"status",{get:()=>e,set:u=>{e=u,e===d.STATUS_DONE&&(p||(p=!0,r()))}})}processApplyValue(t,r){if(t instanceof x)return t.value;if(t.pushStack(new z.Block(r.target.sprite.clones[0].id,r.peekStack(),r.lpp??void 0)),r.lpp)return r.lpp.exceptionCallback(t),r.stopThisScript();this.handleException(t)}shouldExit(t){return!!(this.mutatorClick&&(t.stack.length===1&&(this.mutatorClick=!1),t.stackClick))}getActiveBlockInstance(t,r){let e=r.target.blocks,p=r.isCompiled?r.peekStack():e._cache._executeCached[r.peekStack()]?._ops?.find(u=>t===u._argValues)?.id,d=p?e.getBlock(p)??this.runtime.flyoutBlocks.getBlock(p):void 0;if(!d)throw new Error("lpp: cannot get active block");return d}getMutation(t){return t.mutation}createDummyTarget(t,r){let e=new t({blocks:r});e.id="",e.runtime=this.runtime;let p=()=>{this.handleError(new M("useAfterDispose")),this.runtime.stopAll()};for(let d of Reflect.ownKeys(e.constructor.prototype))typeof d=="string"&&d.startsWith("set")&&Reflect.set(e,d,p);return Reflect.set(e,"makeClone",p),e}stepThread(t){let r=this.util?.thread;if(this.runtime.sequencer.stepThread(t),this.util&&r&&(this.util.thread=r),t.isCompiled&&r&&r.isCompiled&&r.generator){let e=r.generator;r.generator={next:()=>{}},this.runtime.sequencer.stepThread(r),r.generator=e}}static serializeFunction(t,r,e){if(!t||!r)return X({signature:e,script:{},block:null});let p={signature:e,script:ft(r,t),block:t.id};return X(p)}visualReport(t,r,e){if(this.Blockly&&r.stackClick&&r.atStackTop()&&r.peekStack()===t){let p=this.runtime.visualReport;this.runtime.visualReport=function(d,u){return d===d?void(this.visualReport=p):p.call(this,d,u)},A.show(this.Blockly,t,[nt(this.Blockly,this.vm,this.formatMessage.bind(this),e)],e instanceof w?"center":"left")}}}o.vm?.runtime?o.extensions.register(new l(o.vm.runtime)):Reflect.set(window,"tempExt",{Extension:l,info:{name:"lpp.name",description:"lpp.desc",extensionId:"lpp",featured:!0,disabled:!1,collaborator:"FurryR"},l10n:{"zh-cn":{"lpp.name":"lpp","lpp.desc":"\u{1F6E0}\uFE0F (\u5B9E\u9A8C\u6027) \u5411 Scratch \u5F15\u5165 OOP\u3002"},en:{"lpp.name":"lpp","lpp.desc":"\u{1F6E0}\uFE0F (Experimental) Introduces OOP to Scratch."}}})})(Scratch);})();
